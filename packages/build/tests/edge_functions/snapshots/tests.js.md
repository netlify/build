# Snapshot report for `tests/edge_functions/tests.js`

The actual snapshot is saved in `tests.js.snap`.

Generated by [AVA](https://avajs.dev).

## constants.EDGE_FUNCTIONS_SRC default value

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/src_default␊
    ␊
    > Config file␊
      packages/build/tests/edge_functions/fixtures/src_default/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_FUNCTIONS_SRC automatic value

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/src_auto␊
    ␊
    > Config file␊
      packages/build/tests/edge_functions/fixtures/src_auto/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify/edge-functions␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    Edge Functions bundling                                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Edge Functions were found in netlify/edge-functions directory␊
    ␊
    (Edge Functions bundling completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_FUNCTIONS_SRC relative path

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/src_relative␊
    ␊
    > Config file␊
      packages/build/tests/edge_functions/fixtures/src_relative/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    custom-edge-functions␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    Edge Functions bundling                                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Edge Functions were found in custom-edge-functions directory␊
    ␊
    (Edge Functions bundling completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_FUNCTIONS_SRC missing path

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/src_missing␊
    ␊
    > Config file␊
      packages/build/tests/edge_functions/fixtures/src_missing/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    missing false␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    Edge Functions bundling                                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (Edge Functions bundling completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_FUNCTIONS_SRC created dynamically

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ./plugin (onBuild event)                                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify/edge-functions␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ./plugin (onPostBuild event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_FUNCTIONS_SRC dynamic is ignored if EDGE_FUNCTIONS_SRC is specified

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ./plugin (onBuild event)                                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    Edge Functions bundling                                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Edge Functions were found in test directory␊
    ␊
    (Edge Functions bundling completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_FUNCTIONS_DIST default value

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/print_dist␊
    ␊
    > Config file␊
      packages/build/tests/edge_functions/fixtures/print_dist/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    .netlify/edge-functions-dist/␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_FUNCTIONS_DIST custom value

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/print_dist␊
    ␊
    > Config file␊
      packages/build/tests/edge_functions/fixtures/print_dist/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    /external/path␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## builds Edge Functions from the user-defined directory

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/functions_user␊
    ␊
    > Config file␊
      packages/build/tests/edge_functions/fixtures/functions_user/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    Edge Functions bundling                                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Functions from netlify/edge-functions directory:␊
     - function-1␊
    ␊
    (Edge Functions bundling completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## builds Edge Functions from the internal directory

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/functions_internal␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Context␊
      production␊
    ␊
    Edge Functions bundling                                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Functions from .netlify/edge-functions directory:␊
     - function-1␊
    ␊
    (Edge Functions bundling completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## builds Edge Functions from both the user and the internal directories

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/functions_user_internal␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Context␊
      production␊
    ␊
    Edge Functions bundling                                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Functions from .netlify/edge-functions directory:␊
     - function-2␊
    ␊
    Packaging Edge Functions from netlify/edge-functions directory:␊
     - function-1␊
    ␊
    (Edge Functions bundling completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## handles failure when bundling Edge Functions

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/functions_invalid␊
    ␊
    > Config file␊
      packages/build/tests/edge_functions/fixtures/functions_invalid/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    Edge Functions bundling                                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Functions from netlify/edge-functions directory:␊
     - functions-1␊
    ␊
    Bundling of edge function failed                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Command failed with exit code 1: deno run --allow-all --no-config --import-map=/node_module/path --quiet /node_module/path {"basePath":"packages/build/tests/edge_functions/fixtures/functions_invalid","destPath":"packages/build/tests/edge_functions/fixtures/functions_invalid/.netlify/edge-functions-dist/HEXADECIMAL_ID.eszip","externals":[],"functions":[{"name":"functions-1","path":"packages/build/tests/edge_functions/fixtures/functions_invalid/netlify/edge-functions/functions-1.ts"}],"importMapData":"{/"imports/":{/"netlify:edge/":/"https://edge.netlify.com/v1.0.0/index.ts/"},/"scopes/":{}}"}␊
      error: Uncaught (in promise) Error: The module's source code could not be parsed: Expected '{', got 'async' at /external/path␊
    ␊
        export async () => ␊
               ~~~~~␊
            const ret = new Error(getStringFromWasm0(arg0, arg1));␊
                        ^␊
    STACK TRACE␊
    ␊
      Error location␊
      While bundling edge function␊
    ␊
      Resolved config␊
      build:␊
        edge_functions: packages/build/tests/edge_functions/fixtures/functions_invalid/netlify/edge-functions␊
        publish: packages/build/tests/edge_functions/fixtures/functions_invalid␊
        publishOrigin: default`

## handles failure when validating Edge Functions

> Snapshot 1

    `␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/functions_validation_failed␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Context␊
      production␊
    ␊
      1. Edge Functions bundling                                    ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Functions from netlify/edge-functions directory:␊
     - functions-1␊
    ␊
      Bundling of edge function failed                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Validation of Edge Functions manifest failed␊
      FORMAT pattern needs to be a regex that starts with ^ followed by / and ends with $ without any additional slashes before and afterwards␊
    ␊
        13 |     {␊
        14 |       "function": "functions-1",␊
      > 15 |       "pattern": "^hello//?$"␊
           |                  ^^^^^^^^^^^^ 👈🏽  format pattern needs to be a regex that starts with ^ followed by / and ends with $ without any additional slashes before and afterwards␊
        16 |     }␊
        17 |   ],␊
        18 |   "post_cache_routes": [],␊
    ␊
      Error location␊
      While bundling edge function␊
    ␊
      Resolved config␊
      build:␊
        edge_functions: packages/build/tests/edge_functions/fixtures/functions_validation_failed/netlify/edge-functions␊
        publish: packages/build/tests/edge_functions/fixtures/functions_validation_failed␊
        publishOrigin: default`

## bundles Edge Functions via runCoreSteps function

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      buildSteps:␊
        - edge_functions_bundling␊
      debug: false␊
      useRunCoreSteps: true␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/functions_user␊
    ␊
    > Config file␊
      packages/build/tests/edge_functions/fixtures/functions_user/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    Edge Functions bundling                                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Functions from netlify/edge-functions directory:␊
     - function-1␊
    ␊
    (Edge Functions bundling completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## writes manifest contents to stdout if `debug` is set

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      mode: buildbot␊
      repositoryRoot: packages/build/tests/edge_functions/fixtures/functions_user␊
      systemLogFile: 7␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/functions_user␊
    ␊
    > Config file␊
      packages/build/tests/edge_functions/fixtures/functions_user/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        edge_functions: packages/build/tests/edge_functions/fixtures/functions_user/netlify/edge-functions␊
        publish: packages/build/tests/edge_functions/fixtures/functions_user␊
        publishOrigin: default␊
      functions:␊
        '*':␊
          deno_import_map: packages/build/tests/edge_functions/fixtures/functions_user/netlify/edge-functions/import-map.json␊
    ␊
    > Context␊
      production␊
    ␊
    Edge Functions bundling                                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Functions from netlify/edge-functions directory:␊
     - function-1␊
    Edge Functions manifest: {"bundles":[{"asset":"HEXADECIMAL_ID.eszip","format":"eszip2"}],"routes":[{"function":"function-1","pattern":"^/one/?$","excluded_patterns":[]}],"post_cache_routes":[],"bundler_version":"1.0.0","layers":[],"import_map":"netlify:import-map","function_config":{}}␊
    ␊
    (Edge Functions bundling completed in 1ms)␊
    Build step duration: Edge Functions bundling completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## writes manifest contents to system logs if `systemLogFile` is set

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/functions_user␊
    ␊
    > Config file␊
      packages/build/tests/edge_functions/fixtures/functions_user/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    Edge Functions bundling                                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Functions from netlify/edge-functions directory:␊
     - function-1␊
    ␊
    (Edge Functions bundling completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## build plugins can manipulate netlifyToml.edge_functions array

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/edge_functions/fixtures/functions_plugin_mutations␊
    ␊
    > Config file␊
      packages/build/tests/edge_functions/fixtures/functions_plugin_mutations/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ./plugin.js (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "edge_functions" value changed to [ { path: '/external/path', function: 'mutated-function' } ].␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    ␊
    Edge Functions bundling                                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Functions from .netlify/edge-functions directory:␊
     - mutated-function␊
    ␊
    (Edge Functions bundling completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`
