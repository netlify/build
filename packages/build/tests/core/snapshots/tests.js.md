# Snapshot report for `packages/build/tests/core/tests.js`

The actual snapshot is saved in `tests.js.snap`.

Generated by [AVA](https://ava.li).

## --apiHost is used to set Netlify API host

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      apiHost: /test/socket␊
      debug: true␊
      deployId: test␊
      repositoryRoot: packages/build/tests/core/fixtures/cancel␊
      testOpts:␊
        pluginsListUrl: test␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/cancel␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/cancel/netlify.toml␊
    ␊
    > Resolved config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Build canceled by ./plugin.js                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      test␊
    `

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding authorization connection content-length host user-agent',
        method: 'POST',
        url: '/api/v1/deploys/test/cancel',
      },
    ]

## --baseRelDir

> Snapshot 1

    `{␊
      "branch": "branch",␊
      "buildDir": "packages/build/tests/core/fixtures/basereldir/base",␊
      "config": {␊
        "build": {␊
          "base": "packages/build/tests/core/fixtures/basereldir/base",␊
          "command": "echo command",␊
          "commandOrigin": "config",␊
          "environment": {}␊
        },␊
        "functions": {},␊
        "plugins": []␊
      },␊
      "configPath": "packages/build/tests/core/fixtures/basereldir/netlify.toml",␊
      "context": "production",␊
      "env": {␊
        "BRANCH": {␊
          "sources": [␊
            "general"␊
          ],␊
          "value": "branch"␊
        },␊
        "CACHED_COMMIT_REF": {␊
          "sources": [␊
            "general"␊
          ],␊
          "value": "HEXADECIMAL_ID"␊
        },␊
        "COMMIT_REF": {␊
          "sources": [␊
            "general"␊
          ],␊
          "value": "HEXADECIMAL_ID"␊
        },␊
        "CONTEXT": {␊
          "sources": [␊
            "general"␊
          ],␊
          "value": "production"␊
        },␊
        "GATSBY_TELEMETRY_DISABLED": {␊
          "sources": [␊
            "general"␊
          ],␊
          "value": "1"␊
        },␊
        "HEAD": {␊
          "sources": [␊
            "general"␊
          ],␊
          "value": "branch"␊
        },␊
        "LANG": {␊
          "sources": [␊
            "general"␊
          ],␊
          "value": "en_US.UTF-8"␊
        },␊
        "LANGUAGE": {␊
          "sources": [␊
            "general"␊
          ],␊
          "value": "en_US:en"␊
        },␊
        "LC_ALL": {␊
          "sources": [␊
            "general"␊
          ],␊
          "value": "en_US.UTF-8"␊
        },␊
        "NEXT_TELEMETRY_DISABLED": {␊
          "sources": [␊
            "general"␊
          ],␊
          "value": "1"␊
        },␊
        "PULL_REQUEST": {␊
          "sources": [␊
            "general"␊
          ],␊
          "value": "false"␊
        }␊
      },␊
      "repositoryRoot": "packages/build/tests/core/fixtures/basereldir",␊
      "siteInfo": {}␊
    }`

## --branch

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: testContext␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/context␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/context␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/context/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: echo commandTest␊
        commandOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ echo commandTest␊
    commandTest␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --cachedConfig

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/cached_config␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/cached_config␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/cached_config/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: echo command␊
        commandOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ echo command␊
    command␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --cachedConfig CLI flag

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/cached_config␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: 'true'␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/cached_config␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/cached_config/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: echo command␊
        commandOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ echo command␊
    command␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --config

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      config: packages/build/tests/core/fixtures/empty/netlify.toml␊
      debug: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
    ␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --context

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      context: testContext␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/context␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/context␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/context/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: echo commandTest␊
        commandOrigin: config␊
    ␊
    > Context␊
      testContext␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ echo commandTest␊
    commandTest␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --cwd

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      cwd: packages/build/tests/core/fixtures/empty␊
      debug: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        base: packages/build/tests/core/fixtures/empty␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --defaultConfig

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: echo commandDefault␊
        commandOrigin: ui␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Build command from Netlify app                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ echo commandDefault␊
    commandDefault␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --defaultConfig CLI flag

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: 'true'␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: echo commandDefault␊
        commandOrigin: ui␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Build command from Netlify app                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ echo commandDefault␊
    commandDefault␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --dry with build.command but no netlify.toml

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      dry: true␊
      repositoryRoot: packages/build/tests/core/fixtures/none␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/none␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        command: echo␊
        commandOrigin: ui␊
    ␊
    > Context␊
      production␊
    ␊
    > Netlify Build Commands␊
      For more information on build events see the docs https://github.com/netlify/build␊
    ␊
      Running `netlify build` will execute this build flow␊
    ␊
      ┌──────────────┬──────────────┐␊
      │ Event        │ Location     │␊
      └──────────────┴──────────────┘␊
      ┌──────────────┐␊
      │ 1. onBuild   │ Build command from Netlify app␊
      └──────────────┘ ␊
    ␊
      If this looks good to you, run `netlify build` to execute the build␊
    `

## --dry with one event

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      dry: true␊
      repositoryRoot: packages/build/tests/core/fixtures/single␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/single␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/single/netlify.toml␊
    ␊
    > Resolved config␊
      {}␊
    ␊
    > Context␊
      production␊
    ␊
    > Netlify Build Commands␊
      For more information on build events see the docs https://github.com/netlify/build␊
    ␊
      Running `netlify build` will execute this build flow␊
    ␊
      ┌──────────┬──────────┐␊
      │ Event    │ Location │␊
      └──────────┴──────────┘␊
    ␊
      If this looks good to you, run `netlify build` to execute the build␊
    `

## --dry with several events

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      dry: true␊
      repositoryRoot: packages/build/tests/core/fixtures/several␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/several␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/several/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: echo test␊
        commandOrigin: config␊
      functionsDirectory: packages/build/tests/core/fixtures/several/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    > Netlify Build Commands␊
      For more information on build events see the docs https://github.com/netlify/build␊
    ␊
      Running `netlify build` will execute this build flow␊
    ␊
      ┌─────────────────┬─────────────────┐␊
      │ Event           │ Location        │␊
      └─────────────────┴─────────────────┘␊
      ┌─────────────────┐␊
      │ 1. onPreBuild ↓ │ Plugin ./plugin␊
      └─────────────────┘ ␊
      ┌─────────────────┐␊
      │ 2. onBuild    ↓ │ build.command from netlify.toml␊
      └─────────────────┘ ␊
      ┌─────────────────┐␊
      │ 3. onBuild      │ Functions bundling␊
      └─────────────────┘ ␊
    ␊
      If this looks good to you, run `netlify build` to execute the build␊
    `

## --dry-run

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      dry: true␊
      repositoryRoot: packages/build/tests/core/fixtures/single␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: 'true'␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/single␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/single/netlify.toml␊
    ␊
    > Resolved config␊
      {}␊
    ␊
    > Context␊
      production␊
    ␊
    > Netlify Build Commands␊
      For more information on build events see the docs https://github.com/netlify/build␊
    ␊
      Running `netlify build` will execute this build flow␊
    ␊
      ┌──────────┬──────────┐␊
      │ Event    │ Location │␊
      └──────────┴──────────┘␊
    ␊
      If this looks good to you, run `netlify build` to execute the build␊
    `

## --featureFlags can be used

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --help

> Snapshot 1

    `netlify-build [OPTIONS...]␊
    ␊
    Run Netlify Build system locally.␊
    ␊
    Options can also be specified as environment variables prefixed with␊
    NETLIFY_BUILD_. For example the environment variable NETLIFY_BUILD_DRY=true can␊
    be used instead of the CLI flag --dry.␊
    ␊
    Options:␊
      --help            Show help                                          [boolean]␊
      --version         Show version number                                [boolean]␊
      --config          Path to the configuration file.␊
                        Defaults to any netlify.toml in the git repository root␊
                        directory or the base directory                     [string]␊
      --cwd             Current directory. Used to retrieve the configuration file.␊
                        Default: current directory                          [string]␊
      --repositoryRoot  Git repository root directory. Used to retrieve the␊
                        configuration file.␊
                        Default: automatically guessed                      [string]␊
      --apiHost         Netlify API endpoint.␊
                        Default: automatically guessed                      [string]␊
      --token           Netlify API token for authentication.␊
                        The NETLIFY_AUTH_TOKEN environment variable can be used as␊
                        well.                                               [string]␊
      --siteId          Netlify Site ID.                                    [string]␊
      --deployId        Netlify Deploy ID.␊
                        Default: automatically guessed                      [string]␊
      --context         Build context.␊
                        Default: 'production'                               [string]␊
      --branch          Repository branch.␊
                        Default: automatically guessed                      [string]␊
      --dry, --dry-run  Run in dry mode, i.e. printing commands without executing␊
                        them.␊
                        Default: false                                     [boolean]␊
      --nodePath        Path to the Node.js binary to use in user commands and build␊
                        plugins.␊
                        Default: Current Node.js binary                     [string]␊
      --telemetry       Enable telemetry.␊
                        Default: false                                     [boolean]␊
      --offline         Do not send requests to the Netlify API to retrieve site␊
                        settings.␊
                        Default: false                                     [boolean]␊
      --buffer          Buffer output instead of printing it               [boolean]`

## --node-path is not used by core plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/core/fixtures/core␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/core␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/core/netlify.toml␊
    ␊
    > Resolved config␊
      functionsDirectory: packages/build/tests/core/fixtures/core/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - test.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --node-path is used by build.command

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/core/fixtures/build_command␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/build_command␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/build_command/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node --version␊
        commandOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --node-path is used by local plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/core/fixtures/local_node_path␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/local_node_path␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/local_node_path/netlify.toml␊
    ␊
    > Resolved config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin.js                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    expect execPath to equal TEST_NODE_PATH. Got 'true'␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --node-path is used by plugins added to package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/core/fixtures/package␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/package␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/package/netlify.toml␊
    ␊
    > Resolved config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from netlify.toml and package.json␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-test                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    expect execPath to equal TEST_NODE_PATH. Got 'true'␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --repository-root

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --version

> Snapshot 1

    '1.0.0'

## Functions config is passed to zip-it-and-ship-it (1)

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/functions_config_1␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/functions_config_1␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/functions_config_1/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*':␊
          external_node_modules:␊
            - '@netlify/imaginary-module-one'␊
            - '@netlify/imaginary-module-two'␊
            - '@netlify/imaginary-module-three'␊
          included_files:␊
            - directory-1␊
            - directory-2/file-1␊
            - directory-3/**/*.jpg␊
          node_bundler: esbuild␊
      functionsDirectory: packages/build/tests/core/fixtures/functions_config_1/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - function_one.js␊
     - function_two.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions config is passed to zip-it-and-ship-it (2)

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/functions_config_2␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/functions_config_2␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/functions_config_2/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*':␊
          ignored_node_modules:␊
            - '@netlify/imaginary-module-one'␊
          included_files:␊
            - directory-1␊
          node_bundler: esbuild␊
        function_*:␊
          external_node_modules:␊
            - '@netlify/imaginary-module-three'␊
          included_files:␊
            - directory-3/**/*.jpg␊
        function_one:␊
          external_node_modules:␊
            - '@netlify/imaginary-module-two'␊
          included_files:␊
            - directory-2/file-1␊
      functionsDirectory: packages/build/tests/core/fixtures/functions_config_2/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - function_one.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions config is passed to zip-it-and-ship-it (3)

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/functions_config_3␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/functions_config_3␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/functions_config_3/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*':␊
          external_node_modules:␊
            - '@netlify/imaginary-module-one'␊
          included_files:␊
            - directory-1␊
          node_bundler: esbuild␊
        function_one:␊
          external_node_modules:␊
            - '@netlify/imaginary-module-two'␊
          included_files:␊
            - '!directory-1/file-1'␊
      functionsDirectory: packages/build/tests/core/fixtures/functions_config_3/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - function_one.js␊
     - function_two.js␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Dependencies installation error                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      A Netlify Function failed to require one of its dependencies.␊
      Please make sure it is present in the site's top-level "package.json".␊
    ␊
      Build failed with 1 error:␊
      packages/build/tests/core/fixtures/functions_config_3/functions/function_two.js error: Could not resolve "@netlify/imaginary-module-two"␊
    ␊
      Resolved config␊
      functions:␊
        '*':␊
          external_node_modules:␊
            - '@netlify/imaginary-module-one'␊
          included_files:␊
            - directory-1␊
          node_bundler: esbuild␊
        function_one:␊
          external_node_modules:␊
            - '@netlify/imaginary-module-two'␊
          included_files:␊
            - '!directory-1/file-1'␊
      functionsDirectory: packages/build/tests/core/fixtures/functions_config_3/functions`

## No configuration file

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/none␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/none␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Shows notice about bundling errors and warnings coming from esbuild

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/esbuild_errors_1␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/esbuild_errors_1␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/esbuild_errors_1/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*':␊
          node_bundler: esbuild␊
      functionsDirectory: packages/build/tests/core/fixtures/esbuild_errors_1/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - function_simple.js␊
     - function_with_dynamic_require.js␊
     - function_with_native.js␊
    ␊
    ␊
    > Failed to bundle functions with selected bundler (fallback used):␊
       - function_with_native.zip␊
    ␊
    > Functions bundled with warnings:␊
       - function_with_dynamic_require.zip␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Shows notice about modules with dynamic imports and suggests the usage of `functions.external_node_modules`

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/core/fixtures/esbuild_errors_2␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/core/fixtures/esbuild_errors_2␊
    ␊
    > Config file␊
      packages/build/tests/core/fixtures/esbuild_errors_2/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*':␊
          node_bundler: esbuild␊
      functionsDirectory: packages/build/tests/core/fixtures/esbuild_errors_2/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - function_with_module.js␊
    ␊
    ␊
    > Functions bundled with warnings:␊
       - function_with_module.zip␊
    ␊
    > The following Node.js modules use dynamic expressions to include files:␊
       - @org/another-test␊
       - test␊
    ␊
      Because files included with dynamic expressions aren't bundled with your serverless functions by default,␊
      this may result in an error when invoking a function. To resolve this error, you can mark these Node.js␊
      modules as external in the [functions] section of your `netlify.toml` configuration file:␊
    ␊
      [functions]␊
        external_node_modules = ["@org/another-test", "test"]␊
    ␊
      Visit https://ntl.fyi/dynamic-imports for more information.␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## User error

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      config: /external/path␊
      debug: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      When resolving config file /external/path␊
      Configuration file does not exist␊
    `
