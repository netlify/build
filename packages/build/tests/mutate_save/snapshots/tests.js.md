# Snapshot report for `tests/mutate_save/tests.js`

The actual snapshot is saved in `tests.js.snap`.

Generated by [AVA](https://avajs.dev).

## --saveConfig deletes headers file if headers were changed

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/mutate_save/fixtures/save_headers/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/mutate_save/fixtures/save_headers␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/mutate_save/fixtures/save_headers␊
    ␊
    > Config file␊
      packages/build/tests/mutate_save/fixtures/save_headers/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/save_headers␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: three␊
        - for: /external/path␊
          values:␊
            test: one␊
      headersOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "headers" value changed to [␊
      { for: '/external/path', values: { test: 'three' } },␊
      { for: '/external/path', values: { test: 'one' } },␊
      { for: '/external/path', values: { test: 'two' } }␊
    ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/save_headers␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: three␊
        - for: /external/path␊
          values:␊
            test: one␊
        - for: /external/path␊
          values:␊
            test: two␊
      headersOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    Build step duration: ./plugin onBuild completed in 1ms␊
    ␊
    ./plugin (onPostBuild event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      { for: '/external/path', values: { test: 'three' } },␊
      { for: '/external/path', values: { test: 'one' } },␊
      { for: '/external/path', values: { test: 'two' } }␊
    ]␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    Build step duration: ./plugin onPostBuild completed in 1ms␊
    ␊
    Deploy site                                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [[headers]]␊
      for = "/external/path"␊
    ␊
        [headers.values]␊
        test = "three"␊
    ␊
      [[headers]]␊
      for = "/external/path"␊
    ␊
        [headers.values]␊
        test = "one"␊
    ␊
      [[headers]]␊
      for = "/external/path"␊
    ␊
        [headers.values]␊
        test = "two"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
    ␊
          [[context.production.headers]]␊
          for = "/external/path"␊
    ␊
            [context.production.headers.values]␊
            test = "three"␊
    ␊
          [[context.production.headers]]␊
          for = "/external/path"␊
    ␊
            [context.production.headers.values]␊
            test = "one"␊
    ␊
          [[context.production.headers]]␊
          for = "/external/path"␊
    ␊
            [context.production.headers.values]␊
            test = "two"␊
    ␊
        [context.main]␊
    ␊
          [[context.main.headers]]␊
          for = "/external/path"␊
    ␊
            [context.main.headers.values]␊
            test = "three"␊
    ␊
          [[context.main.headers]]␊
          for = "/external/path"␊
    ␊
            [context.main.headers.values]␊
            test = "one"␊
    ␊
          [[context.main.headers]]␊
          for = "/external/path"␊
    ␊
            [context.main.headers.values]␊
            test = "two"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    Build step duration: Deploy site completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## --saveConfig deletes headers file if any configuration property was changed

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/mutate_save/fixtures/delete_headers/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/mutate_save/fixtures/delete_headers␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/mutate_save/fixtures/delete_headers␊
    ␊
    > Config file␊
      packages/build/tests/mutate_save/fixtures/delete_headers/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/delete_headers␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: three␊
        - for: /external/path␊
          values:␊
            test: one␊
      headersOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST␊
        publish: packages/build/tests/mutate_save/fixtures/delete_headers␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: three␊
        - for: /external/path␊
          values:␊
            test: one␊
      headersOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Deploy site                                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
    ␊
        [build.environment]␊
        TEST = "test"␊
    ␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [[headers]]␊
      for = "/external/path"␊
    ␊
        [headers.values]␊
        test = "three"␊
    ␊
      [[headers]]␊
      for = "/external/path"␊
    ␊
        [headers.values]␊
        test = "one"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
    ␊
          [context.production.environment]␊
          TEST = "test"␊
    ␊
          [context.production.build]␊
    ␊
            [context.production.build.environment]␊
            TEST = "test"␊
    ␊
        [context.main]␊
    ␊
          [context.main.environment]␊
          TEST = "test"␊
    ␊
          [context.main.build]␊
    ␊
            [context.main.build.environment]␊
            TEST = "test"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    Build step duration: Deploy site completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Erroneous headers created by a plugin are handled

> Snapshot 1

    `␊
    Warning: some headers have syntax errors:␊
    ␊
    Could not parse header number 1:␊
      {"values":{}}␊
    Missing "for" field␊
    ␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/mutate_save/fixtures/headers_plugin_error/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/mutate_save/fixtures/headers_plugin_error␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: "true"␊
    ␊
    > Current directory␊
      packages/build/tests/mutate_save/fixtures/headers_plugin_error␊
    ␊
    > Config file␊
      packages/build/tests/mutate_save/fixtures/headers_plugin_error/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/headers_plugin_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "headers" value changed to [ { values: {} } ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/headers_plugin_error␊
        publishOrigin: default␊
      headersOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    ./plugin (onBuild event)                                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    []␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    Build step duration: ./plugin onBuild completed in 1ms␊
    ␊
    Deploy site                                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
    ␊
          [[context.production.headers]]␊
    ␊
            [context.production.headers.values]␊
    ␊
        [context.main]␊
    ␊
          [[context.main.headers]]␊
    ␊
            [context.main.headers.values]␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    Build step duration: Deploy site completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms␊
    ␊
    ␊
    Warning: some headers have syntax errors:␊
    ␊
    Could not parse header number 1:␊
      {"values":{}}␊
    Missing "for" field`

## --saveConfig deletes redirects file if redirects were changed

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/mutate_save/fixtures/save_redirects/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/mutate_save/fixtures/save_redirects␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/mutate_save/fixtures/save_redirects␊
    ␊
    > Config file␊
      packages/build/tests/mutate_save/fixtures/save_redirects/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/save_redirects␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          status: 200␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "redirects" value changed to [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        status: 200,␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      { from: '/external/path', to: '/external/path' }␊
    ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/save_redirects␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          status: 200␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: inline␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    Build step duration: ./plugin onBuild completed in 1ms␊
    ␊
    Deploy site                                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [[redirects]]␊
      from = "/external/path"␊
      to = "/external/path"␊
      status = 200␊
    ␊
      [[redirects]]␊
      from = "/external/path"␊
      to = "/external/path"␊
    ␊
      [[redirects]]␊
      from = "/external/path"␊
      to = "/external/path"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
    ␊
        [context.main]␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    Build step duration: Deploy site completed in 1ms␊
    ␊
    ./plugin (onSuccess event)                                    ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        status: 200,␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      }␊
    ]␊
    ␊
    (./plugin onSuccess completed in 1ms)␊
    Build step duration: ./plugin onSuccess completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## --saveConfig deletes redirects file if any configuration property was changed

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/mutate_save/fixtures/delete_redirects/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/mutate_save/fixtures/delete_redirects␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/mutate_save/fixtures/delete_redirects␊
    ␊
    > Config file␊
      packages/build/tests/mutate_save/fixtures/delete_redirects/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/delete_redirects␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          status: 200␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST␊
        publish: packages/build/tests/mutate_save/fixtures/delete_redirects␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          status: 200␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: config␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Deploy site                                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
    ␊
        [build.environment]␊
        TEST = "test"␊
    ␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [[redirects]]␊
      from = "/external/path"␊
      to = "/external/path"␊
      status = 200␊
    ␊
      [[redirects]]␊
      from = "/external/path"␊
      to = "/external/path"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
    ␊
          [context.production.environment]␊
          TEST = "test"␊
    ␊
          [context.production.build]␊
    ␊
            [context.production.build.environment]␊
            TEST = "test"␊
    ␊
        [context.main]␊
    ␊
          [context.main.environment]␊
          TEST = "test"␊
    ␊
          [context.main.build]␊
    ␊
            [context.main.build.environment]␊
            TEST = "test"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    Build step duration: Deploy site completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## --saveConfig saves the configuration changes as netlify.toml

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/mutate_save/fixtures/save_changes/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/mutate_save/fixtures/save_changes␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/mutate_save/fixtures/save_changes␊
    ␊
    > Config file␊
      packages/build/tests/mutate_save/fixtures/save_changes/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/save_changes␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/mutate_save/fixtures/save_changes␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    build.command from a plugin                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    ␊
    Deploy site                                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
      command = "node --version"␊
    ␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
        command = "node --version"␊
    ␊
          [context.production.build]␊
          command = "node --version"␊
    ␊
        [context.main]␊
        command = "node --version"␊
    ␊
          [context.main.build]␊
          command = "node --version"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    Build step duration: Deploy site completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## --saveConfig is required to save the configuration changes as netlify.toml

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/mutate_save/fixtures/save_none/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/mutate_save/fixtures/save_none␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/mutate_save/fixtures/save_none␊
    ␊
    > Config file␊
      packages/build/tests/mutate_save/fixtures/save_none/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/save_none␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/mutate_save/fixtures/save_none␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    build.command from a plugin                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    ␊
    Deploy site                                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    Build step duration: Deploy site completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## --saveConfig creates netlify.toml if it does not exist

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/mutate_save/fixtures/save_empty␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/mutate_save/fixtures/save_empty␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/save_empty␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from Netlify app␊
    ␊
    ./plugin.js (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/mutate_save/fixtures/save_empty␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: ./plugin.js␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.js onPreBuild completed in 1ms␊
    ␊
    build.command from a plugin                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    ␊
    Deploy site                                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
      command = "node --version"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
        command = "node --version"␊
    ␊
          [context.production.build]␊
          command = "node --version"␊
    ␊
        [context.main]␊
        command = "node --version"␊
    ␊
          [context.main.build]␊
          command = "node --version"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    Build step duration: Deploy site completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## --saveConfig gives higher priority to configuration changes than context properties

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/mutate_save/fixtures/save_context/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/mutate_save/fixtures/save_context␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/mutate_save/fixtures/save_context␊
    ␊
    > Config file␊
      packages/build/tests/mutate_save/fixtures/save_context/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: mainCommand␊
        commandOrigin: config␊
        publish: packages/build/tests/mutate_save/fixtures/save_context␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/mutate_save/fixtures/save_context␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    build.command from a plugin                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    ␊
    Deploy site                                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
      command = "node --version"␊
    ␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
        command = "node --version"␊
    ␊
          [context.production.build]␊
          command = "node --version"␊
    ␊
        [context.main]␊
        command = "node --version"␊
    ␊
          [context.main.build]␊
          command = "node --version"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    Build step duration: Deploy site completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## --saveConfig is performed before deploy

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/mutate_save/fixtures/save_deploy␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/mutate_save/fixtures/save_deploy␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/save_deploy␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from Netlify app␊
    ␊
    ./plugin.js (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/mutate_save/fixtures/save_deploy␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: ./plugin.js␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.js onPreBuild completed in 1ms␊
    ␊
    build.command from a plugin                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    ␊
    Deploy site                                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
      command = "node --version"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
        command = "node --version"␊
    ␊
          [context.production.build]␊
          command = "node --version"␊
    ␊
        [context.main]␊
        command = "node --version"␊
    ␊
          [context.main.build]␊
          command = "node --version"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    Build step duration: Deploy site completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## --saveConfig writes the mutated config to the path in --outputConfigPath

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      context: production␊
      debug: true␊
      outputConfigPath: /external/path␊
      repositoryRoot: packages/build/tests/mutate_save/fixtures/save_changes␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/mutate_save/fixtures/save_changes␊
    ␊
    > Config file␊
      packages/build/tests/mutate_save/fixtures/save_changes/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/mutate_save/fixtures/save_changes␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from Netlify app␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin.js (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/mutate_save/fixtures/save_changes␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.js onPreBuild completed in 1ms␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    build.command from a plugin                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    ␊
    Save deploy artifacts                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    ␊
    (Save deploy artifacts completed in 1ms)␊
    Build step duration: Save deploy artifacts completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`
