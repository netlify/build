# Snapshot report for `packages/build/tests/plugins/tests.js`

The actual snapshot is saved in `tests.js.snap`.

Generated by [AVA](https://ava.li).

## Can execute local binaries when using .netlify/plugins/

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache_bin␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache_bin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache_bin/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    1.0.0␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Can require site dependencies when using .netlify/plugins/

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache_site_deps␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache_site_deps␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache_site_deps/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Can run utils

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - test/test.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Can use local plugins even when some plugins are cached

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache_local␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache_local␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache_local/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onPostBuild command from ./plugin.js                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin.js onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Deploy plugin response syntax error

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      buildbotServerSocket: /test/socket␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Internal error during "Deploy site"                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Invalid response from buildbot: SyntaxError: Unexpected token e in JSON at position 1␊
    ␊
      Error location␊
      During Deploy site␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}`

## Deploy plugin response system error

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      buildbotServerSocket: /test/socket␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Internal error during "Deploy site"                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Deploy did not succeed: test␊
    ␊
      Error location␊
      During Deploy site␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}`

## Deploy plugin response user error

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      buildbotServerSocket: /test/socket␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Deploy did not succeed: test␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}`

## Deploy plugin succeeds

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      buildbotServerSocket: /test/socket␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Do not allow overriding core plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/core_override␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/core_override␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/core_override/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: '@netlify/plugin-edge-handlers'␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Do not pin plugin versions if already pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (pinned 0, latest 1-0-0, expected 0, compatible 1-0-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-3-0: latest version is 1-0-0␊
         To upgrade this plugin, please uninstall and re-install it from the Netlify plugins directory (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Do not pin plugin versions if the build failed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_build_failed␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_build_failed␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_build_failed/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node --invalid␊
        commandOrigin: config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --invalid␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      "build.command" failed                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Command failed with exit code 9: node --invalid␊
    ␊
      Error location␊
      In build.command from netlify.toml:␊
      node --invalid␊
    ␊
      Resolved config␊
      build:␊
        command: node --invalid␊
        commandOrigin: config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    node: bad option: --invalid`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Do not pin plugin versions if the build was installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_module␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_module␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_module/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from netlify.toml and package.json␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-test                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Do not pin plugin versions if the plugin failed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_plugin_failed␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_plugin_failed␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "netlify-plugin-contextual-env" failed                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: test␊
    ␊
      Plugin details␊
      Package:        netlify-plugin-contextual-env␊
      Version:        1.0.0␊
      Repository:     test␊
      npm link:       https://www.npmjs.com/package/netlify-plugin-contextual-env␊
    ␊
      Error location␊
      In "onPreBuild" event in "netlify-plugin-contextual-env" from Netlify app␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Do not pin plugin versions without a siteId

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Do not pin plugin versions without an API token

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Do not use plugins cached in .netlify/plugins/ if outdated

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache_outdated␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache_outdated␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache_outdated/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not pin netlify.toml-only plugin versions if already pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (pinned 0, latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if installed in UI

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_ui␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_ui␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_module␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_module␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_module/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 1-0-1 from netlify.toml and package.json (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if there are no API token

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if there are no matching plugin runs

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding authorization connection host user-agent',
        method: 'GET',
        url: '/api/v1/sites/test/plugin_runs/latest?packages%5B%5D=netlify-plugin-contextual-env&state=success',
      },
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if there are no matching plugin runs version

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding authorization connection host user-agent',
        method: 'GET',
        url: '/api/v1/sites/test/plugin_runs/latest?packages%5B%5D=netlify-plugin-contextual-env&state=success',
      },
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if there are no plugin runs

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding authorization connection host user-agent',
        method: 'GET',
        url: '/api/v1/sites/test/plugin_runs/latest?packages%5B%5D=netlify-plugin-contextual-env&state=success',
      },
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if there are no site ID

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not print incompatible plugins installed in package.json if major version is same

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_incompatible_package_json_same_major␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_incompatible_package_json_same_major␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_incompatible_package_json_same_major/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-4-0 from netlify.toml and package.json (latest 0-4-0, expected 0-4-1, compatible 0-4-1)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not print incompatible plugins installed in package.json if not using the compatibility field

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_incompatible_package_json␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_incompatible_package_json␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_incompatible_package_json/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 1-0-0 from netlify.toml and package.json (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not report 404 updatePlugin API error

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
      {
        body: {
          pinned_version: '0.3',
        },
        headers: 'accept accept-encoding authorization connection content-length content-type host user-agent',
        method: 'PUT',
        url: '/api/v1/sites/test/plugins/netlify-plugin-contextual-env',
      },
    ]

## Edge handlers: can configure directory

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/handlers_custom_dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/handlers_custom_dir␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/handlers_custom_dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/handlers_custom_dir/custom-edge-handlers␊
      functions:␊
        '*': {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from @netlify/plugin-edge-handlers         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Handlers from custom-edge-handlers directory:␊
     - test␊
    ␊
    (@netlify/plugin-edge-handlers onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Edge handlers: simple setup

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/handlers_simple␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/handlers_simple␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/handlers_simple/edge-handlers␊
      functions:␊
        '*': {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from @netlify/plugin-edge-handlers         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Handlers from edge-handlers directory:␊
     - test␊
    ␊
    (@netlify/plugin-edge-handlers onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Expose some utils

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/keys␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/keys␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/keys/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    build cache functions git run status␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Fails the build when pinning netlify.toml-only plugin versions and the API request fails

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      API error on "getLatestPluginRuns"                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Bad Request␊
    ␊
      Error location␊
      While calling the Netlify API endpoint 'getLatestPluginRuns' with:␊
      {␊
        "site_id": "test",␊
        "packages": [␊
          "netlify-plugin-contextual-env"␊
        ],␊
        "state": "success"␊
      }␊
    ␊
      Error properties␊
      {␊
        name: 'JSONHTTPError',␊
        status: 400,␊
        json: [ { package: 'netlify-plugin-contextual-env', version: '1.0.0' } ]␊
      }␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding authorization connection host user-agent',
        method: 'GET',
        url: '/api/v1/sites/test/plugin_runs/latest?packages%5B%5D=netlify-plugin-contextual-env&state=success',
      },
    ]

## Fetches the list of plugin versions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions: --functionsDistDir

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      functionsDistDir: /tmp-dir␊
      repositoryRoot: packages/build/tests/plugins/fixtures/simple␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/simple␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/simple/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/simple/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - test.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions: default directory

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/default␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/default␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/default/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions: invalid package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_package_json_invalid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_package_json_invalid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_package_json_invalid/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_package_json_invalid/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - test.js␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      packages/build/tests/plugins/fixtures/functions_package_json_invalid/package.json is invalid JSON: packages/build/tests/plugins/fixtures/functions_package_json_invalid/package.json: Unexpected token { in JSON at position 1␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_package_json_invalid/functions`

## Functions: missing source directory

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/missing␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/missing␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/missing/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/missing/missing␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    The Netlify Functions setting targets a non-existing directory: missing␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions: must not be a regular file

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/regular_file␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/regular_file␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/regular_file/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/regular_file/functions/test.js␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      The Netlify Functions setting should target a directory, not a regular file: functions/test.js␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/regular_file/functions/test.js`

## Functions: no functions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/none␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/none␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/none/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/none/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions: simple setup

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/simple␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/simple␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/simple/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/simple/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - test.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Git utils does not fail if no root and not used

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    build cache functions git run status␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Git utils fails if no root

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Invalid head commit HEAD␊
      Command failed with exit code 128: git rev-parse HEAD␊
      fatal: not a git repository (or any of the parent directories): .git␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Install plugins in .netlify/plugins/ when not cached

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/valid_package␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/valid_package␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/valid_package/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Local plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Local plugins absolute path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local_absolute␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local_absolute␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local_absolute/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: /external/path␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - /external/path from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from /external/path                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (/external/path onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Local plugins directory

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local_dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local_dir␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local_dir/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Local plugins invalid path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local_invalid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local_invalid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local_invalid/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Plugin could not be found using local path: ./plugin␊
      Cannot find module './plugin'␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Node module plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/module␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/module␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/module/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from netlify.toml and package.json␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-test                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Non-existing plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/non_existing␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/non_existing␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/non_existing/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: does-not-exist␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Plugins must be installed either in the Netlify App or in "package.json".␊
      Please run "npm install -D does-not-exist" or "yarn add -D does-not-exist".␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: does-not-exist`

## Only pin plugin versions in production

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: false␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Only prints the list of plugin versions in verbose mode

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Pass empty packageJson to plugins if no package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Pass empty packageJson to plugins if package.json invalid

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/package_json_invalid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/package_json_invalid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/package_json_invalid/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Pass netlifyConfig to plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_valid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_valid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_valid/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Pass packageJson to plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/package_json_valid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/package_json_valid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/package_json_valid/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test_plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Pin netlify.toml-only plugin versions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (pinned 0.3, latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding authorization connection host user-agent',
        method: 'GET',
        url: '/api/v1/sites/test/plugin_runs/latest?packages%5B%5D=netlify-plugin-contextual-env&state=success',
      },
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Pin plugin versions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
      {
        body: {
          pinned_version: '0.3',
        },
        headers: 'accept accept-encoding authorization connection content-length content-type host user-agent',
        method: 'PUT',
        url: '/api/v1/sites/test/plugins/netlify-plugin-contextual-env',
      },
    ]

## Pinning plugin versions takes into account the compatibility field

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (pinned 0, latest 1-0-0, expected 0-3-0, compatible 100-0-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-3-0: latest version is 1-0-0␊
         To upgrade this plugin, please uninstall and re-install it from the Netlify plugins directory (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Plugin output can interleave stdout and stderr

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/interleave␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/interleave␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/interleave/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    three␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    ␊
    two`

## Plugins can execute local binaries

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local_bin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local_bin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local_bin/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can have inputs

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/inputs␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/inputs␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/inputs/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs:␊
            test: true␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify compatibility.migrationGuide

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-1-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-1-0 from netlify.toml (latest 0-3-0, expected 0-1-0, compatible 0-1-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-1-0: latest version is 0-3-0␊
         Migration guide: http://test.com␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify matching compatibility.nodeVersion

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify matching compatibility.siteDependencies

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify multiple matching compatibility conditions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify multiple non-matching compatibility conditions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify non-existing compatibility.siteDependencies

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify non-matching compatibility.nodeVersion

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-1-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-1-0 from netlify.toml (latest 0-3-0, expected 0-1-0, compatible 0-1-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-1-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify non-matching compatibility.siteDependencies

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify non-matching compatibility.siteDependencies range

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies_range␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies_range␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies_range/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins compatibility defaults to version field

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins does not ignore compatibility entries without conditions if pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (pinned 0-2-0, latest 0-3-0, expected 0-2-0, compatible 0-3-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins ignore compatibility conditions if pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (pinned 0-2-0, latest 0-3-0, expected 0-2-0, compatible 0-3-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins ignore compatibility entries without conditions unless pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-1-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-1-0 from netlify.toml (latest 0-3-0, expected 0-1-0, compatible 0-1-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-1-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Print a warning when using plugins not in plugins.json nor package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/invalid_package␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/invalid_package␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/invalid_package/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: power-cartesian-product␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    `

## Prints incompatible plugins installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_incompatible_package_json␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_incompatible_package_json␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_incompatible_package_json/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 1-0-0 from netlify.toml and package.json (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Incompatible plugins␊
       - netlify-plugin-contextual-env 1-0-0: version 1.0.0 is the most recent version compatible with Node.js <100␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Prints outdated plugins installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_outdated_package_json␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_outdated_package_json␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_outdated_package_json/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml and package.json (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please update its version in "package.json"␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Report updatePlugin API error without failing the build

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      API error on "updatePlugin"                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Bad Request␊
    ␊
      Error location␊
      While calling the Netlify API endpoint 'updatePlugin' with:␊
      {␊
        "package": "netlify-plugin-contextual-env",␊
        "site_id": "test",␊
        "body": {␊
          "pinned_version": "0.3"␊
        }␊
      }␊
    ␊
      Error properties␊
      { name: 'JSONHTTPError', status: 400, json: {} }␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
      {
        body: {
          pinned_version: '0.3',
        },
        headers: 'accept accept-encoding authorization connection content-length content-type host user-agent',
        method: 'PUT',
        url: '/api/v1/sites/test/plugins/netlify-plugin-contextual-env',
      },
    ]

## Resolution is relative to the build directory

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      config: packages/build/tests/plugins/fixtures/module_base/netlify.toml␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/module_base␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/module_base/base␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/module_base/base/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        base: packages/build/tests/plugins/fixtures/module_base/base␊
        publish: packages/build/tests/plugins/fixtures/module_base/base␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from netlify.toml and package.json␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-test                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## UI plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/ui␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/ui␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from Netlify app and package.json␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-test                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Use plugins cached in .netlify/plugins/

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Uses fallback when the plugins fetch fails

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    Warning: could not fetch latest plugins list. Plugins versions might not be the latest.␊
    Response code 500 (Internal Server Error)␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Utils are defined

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/defined␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/defined␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/defined/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    getCacheDir has list remove restore save␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Validate --node-path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/plugins/fixtures/node_version_simple␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/node_version_simple␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/node_version_simple/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Invalid --node-path CLI flag: /external/path␊
    `

## Validate --node-path unsupported version does not fail when no plugins are used

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/plugins/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Validate --node-path version is supported by our codebase

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/plugins/fixtures/node_version_simple␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/node_version_simple␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/node_version_simple/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      The Node.js version is 1.0.0 but it should be >=1.0.0 when using build plugins either:␊
        - from the same repository (as opposed to npm modules)␊
        - or added to "package.json"␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## Validate --node-path version is supported by the plugin

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/plugins/fixtures/engines␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/engines␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/engines/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      The Node.js version is 1.0.0 but the plugin "./plugin.js" requires >=1.0.0␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## Validate plugin event handler function

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/handler_function␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/handler_function␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/handler_function/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      TypeError: Invalid event handler 'onBuild': must be a function␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      While loading "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Validate plugin event handler names

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/handler_name␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/handler_name␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/handler_name/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Invalid event 'onInvalid'.␊
      Please use a valid event name. One of:␊
       - onPreBuild␊
       - onBuild␊
       - onPostBuild␊
       - onSuccess␊
       - onError␊
       - onEnd␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      While loading "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Validate plugin is an object

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/object␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/object␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/object/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Plugin must be an object or a function␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      While loading "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Works with .netlify being a regular file

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache_regular_file␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache_regular_file␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache_regular_file/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from netlify-plugin-contextual-env      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.CACHE_DIR CI

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      cacheDir: /external/path␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/cache␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/cache/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    /external/path␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.CACHE_DIR local

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/cache␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/cache/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    .netlify/cache␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.CONFIG_PATH

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_path␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_path␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_path/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify.toml␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_HANDLERS_SRC automatic value

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/edge_handlers_src_auto␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_auto␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_auto/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/edge_handlers_src_auto/edge-handlers␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    edge-handlers␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onBuild command from @netlify/plugin-edge-handlers         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Edge Handlers were found in edge-handlers directory␊
    ␊
    (@netlify/plugin-edge-handlers onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_HANDLERS_SRC created dynamically

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onBuild command from ./plugin                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    edge-handlers␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. onPostBuild command from ./plugin                          ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_HANDLERS_SRC default value

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/edge_handlers_src_default␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_default␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_default/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_HANDLERS_SRC dynamic is ignored if EDGE_HANDLERS_SRC is specified

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        edge_handlers: /tmp-dir/test␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onBuild command from ./plugin                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. onBuild command from @netlify/plugin-edge-handlers         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Edge Handlers were found in test directory␊
    ␊
    (@netlify/plugin-edge-handlers onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_HANDLERS_SRC missing path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/edge_handlers_src_missing␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_missing␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_missing/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/edge_handlers_src_missing/missing␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    missing false␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onBuild command from @netlify/plugin-edge-handlers         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "@netlify/plugin-edge-handlers" failed                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Edge Handlers directory does not exist: packages/build/tests/plugins/fixtures/edge_handlers_src_missing/missing␊
    ␊
      Plugin details␊
      Package:        @netlify/plugin-edge-handlers␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/netlify-plugin-edge-handlers.git␊
      npm link:       https://www.npmjs.com/package/@netlify/plugin-edge-handlers␊
      Report issues:  https://github.com/netlify/netlify-plugin-edge-handlers/issues␊
    ␊
      Error location␊
      In "onBuild" event in "@netlify/plugin-edge-handlers" from core␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/edge_handlers_src_missing/missing␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## constants.EDGE_HANDLERS_SRC relative path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/edge_handlers_src_relative␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_relative␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_relative/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/edge_handlers_src_relative/custom-edge-handlers␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    custom-edge-handlers␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onBuild command from @netlify/plugin-edge-handlers         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Edge Handlers were found in custom-edge-handlers directory␊
    ␊
    (@netlify/plugin-edge-handlers onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_DIST

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_dist␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_dist␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_dist/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    .netlify/functions/␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC automatic value

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_src_auto␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_src_auto␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_src_auto/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC created dynamically

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onBuild command from ./plugin                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify/functions␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. onPostBuild command from ./plugin                          ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC default value

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_src_default␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_src_default␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_src_default/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC dynamic is ignored if FUNCTIONS_SRC is specified

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: /tmp-dir/test␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onBuild command from ./plugin                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in test directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC dynamic should bundle Functions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in netlify/functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC ignores the legacy default functions directory if the new default directory exists

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_src_default_and_legacy␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_src_default_and_legacy␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_src_default_and_legacy/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_src_default_and_legacy/netlify/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify/functions␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in netlify/functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC missing path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_src_missing␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_src_missing␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_src_missing/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_src_missing/missing␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    missing false␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    The Netlify Functions setting targets a non-existing directory: missing␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC relative path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_src_relative␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_src_relative␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_src_relative/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_src_relative/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    functions␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC uses legacy default functions directory if it exists

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_src_legacy␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_src_legacy␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_src_legacy/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_src_legacy/netlify-automatic-functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify-automatic-functions␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in netlify-automatic-functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.IS_LOCAL CI

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      mode: buildbot␊
      repositoryRoot: packages/build/tests/plugins/fixtures/is_local␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/is_local␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/is_local/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    false␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.IS_LOCAL local

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/is_local␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/is_local␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/is_local/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.NETLIFY_API_HOST

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      apiHost: test.api.netlify.com␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/netlify_api_host␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/netlify_api_host␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/netlify_api_host/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test.api.netlify.com␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.NETLIFY_API_HOST default value is set to api.netlify.com

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/netlify_api_host␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/netlify_api_host␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/netlify_api_host/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    api.netlify.com␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.NETLIFY_API_TOKEN

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/netlify_api_token␊
      testOpts:␊
        env: false␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/netlify_api_token␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/netlify_api_token/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.NETLIFY_BUILD_VERSION

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/netlify_build_version␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/netlify_build_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/netlify_build_version/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    1.0.0␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.PUBLISH_DIR absolute path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/publish_absolute␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/publish_absolute␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/publish_absolute/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/publish_absolute/doesNotExist␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    doesNotExist␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.PUBLISH_DIR default value

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/publish_default␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/publish_default␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/publish_default/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    packages/build/tests/plugins/fixtures/publish_default true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.PUBLISH_DIR default value with build.base

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/publish_default_base␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/publish_default_base/base␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/publish_default_base/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        base: packages/build/tests/plugins/fixtures/publish_default_base/base␊
        publish: packages/build/tests/plugins/fixtures/publish_default_base/base␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: /external/path␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - /external/path from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from /external/path                          ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    packages/build/tests/plugins/fixtures/publish_default_base/base true␊
    ␊
    (/external/path onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.PUBLISH_DIR missing path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/publish_missing␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/publish_missing␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/publish_missing/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/publish_missing/publish␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    publish false␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.PUBLISH_DIR relative path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/publish_relative␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/publish_relative␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/publish_relative/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/publish_relative/publish␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    publish␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.SITE_ID

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/site_id␊
      siteId: test␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/site_id␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/site_id/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig properties are deeply readonly by default

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_readonly_deep␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_readonly_deep␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_readonly_deep/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: "netlifyConfig.plugins.*.inputs.example" is read-only.␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## netlifyConfig properties are readonly (defineProperty) by default

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_readonly_define␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_readonly_define␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_readonly_define/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: "netlifyConfig.build.ignore" is read-only.␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## netlifyConfig properties are readonly (delete) by default

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_readonly_delete␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_readonly_delete␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_readonly_delete/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: "netlifyConfig.build.ignore" is read-only.␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## netlifyConfig properties are readonly (preventExtensions) by default

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_readonly_prevent␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_readonly_prevent␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_readonly_prevent/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Using the "validateAnyProperty()" method on "netlifyConfig" is not allowed.␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## netlifyConfig properties are readonly (set) by default

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_readonly_set␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_readonly_set␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_readonly_set/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: "netlifyConfig.build.ignore" is read-only.␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## netlifyConfig properties are readonly (setPrototypeOf) by default

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_readonly_proto␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_readonly_proto␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_readonly_proto/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Using the "setPrototypeOf()" method on "netlifyConfig" is not allowed.␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## plugin.onEnd and plugin.onError can be used together

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_error␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_error␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_error/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onError command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onError␊
    ␊
    (./plugin.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. onEnd command from ./plugin.js                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd␊
    ␊
    (./plugin.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onEnd can be used in several plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_several␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_several␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_several/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
       - ./handler_one.js@1.0.0 from netlify.toml␊
       - ./handler_two.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onEnd command from ./handler_one.js                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd one␊
    ␊
    (./handler_one.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. onEnd command from ./handler_two.js                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd two␊
    ␊
    (./handler_two.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js`

## plugin.onEnd can fail but it does not stop builds

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_fail␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_fail␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_fail/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onEnd command from ./plugin.js                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onEnd␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onEnd" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onEnd is not triggered on failPlugin()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_fail_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_fail_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_fail_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" failed                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onEnd is triggered on cancelBuild()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_cancel_build␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_cancel_build␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_cancel_build/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onEnd command from ./plugin.js                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd␊
    ␊
    (./plugin.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Build canceled by ./plugin.js                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      onBuild␊
    `

## plugin.onEnd is triggered on failure

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_not_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_not_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_not_ok/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onEnd command from ./plugin.js                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd␊
    ␊
    (./plugin.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onEnd is triggered on success

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_ok/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onEnd command from ./plugin.js                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd␊
    ␊
    (./plugin.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onError can be used in several plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_several␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_several␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_several/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
       - ./handler_one.js@1.0.0 from netlify.toml␊
       - ./handler_two.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onError command from ./handler_one.js                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./handler_one.js" internal error                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onError␊
    ␊
      Plugin details␊
      Package:        ./handler_one.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onError" event in "./handler_one.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. onError command from ./handler_two.js                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./handler_two.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js`

## plugin.onError can fail

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_fail␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_fail␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_fail/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onError command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onError␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onError" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onError gets an error argument

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_argument␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_argument␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_argument/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onError command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    TestError␊
    test␊
    TestError: test␊
    STACK TRACE␊
    ␊
    (./plugin.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      TestError: test␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onError is not triggered on failPlugin()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_fail_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_fail_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_fail_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" failed                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onError is not triggered on success

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_ok/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onError is triggered on cancelBuild()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_cancel_build␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_cancel_build␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_cancel_build/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onError command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onError␊
    ␊
    (./plugin.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Build canceled by ./plugin.js                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      onBuild␊
    `

## plugin.onError is triggered on failure

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_not_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_not_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_not_ok/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onError command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onError␊
    ␊
    (./plugin.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onSuccess can fail but does not stop builds

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/success_fail␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/success_fail␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/success_fail/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onSuccess command from ./plugin.js                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onSuccess␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onSuccess" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onSuccess is not triggered on cancelBuild()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/success_cancel_build␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/success_cancel_build␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/success_cancel_build/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Build canceled by ./plugin.js                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      onBuild␊
    `

## plugin.onSuccess is not triggered on failPlugin()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/success_fail_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/success_fail_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/success_fail_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" failed                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onSuccess is not triggered on failure

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/success_not_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/success_not_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/success_not_ok/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onSuccess is triggered on success

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/success_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/success_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/success_ok/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onBuild command from ./plugin.js                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onSuccess command from ./plugin.js                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onSuccess␊
    ␊
    (./plugin.js onSuccess completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## process.env changes are propagated to build.command

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_command␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_command␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_command/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node print_env1.0.0js␊
        commandOrigin: config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node print_env1.0.0js␊
    one two en_US.UTF-8 undefined␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## process.env changes are propagated to onError and onEnd

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_on_error␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_on_error␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_on_error/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onBuild command from ./plugin                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. onError command from ./plugin                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    (./plugin onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      4. onEnd command from ./plugin                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    (./plugin onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## process.env changes are propagated to other plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      functions:␊
        '*': {}␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin_two␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
       - ./plugin_two@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. onPreBuild command from ./plugin                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. onPreBuild command from ./plugin_two                       ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin_two onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. onBuild command from ./plugin                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      4. onBuild command from ./plugin_two                          ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin_two onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      5. onPostBuild command from ./plugin                          ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined twoChanged en_US.UTF-8␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`
