# Snapshot report for `packages/build/tests/plugins/tests.js`

The actual snapshot is saved in `tests.js.snap`.

Generated by [AVA](https://avajs.dev).

## Pass netlifyConfig to plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_valid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_valid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_valid/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_valid␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig properties are readonly (set) by default

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_readonly_set␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_readonly_set␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_readonly_set/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_readonly_set␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.ignore" value changed to ''.␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: "netlifyConfig.build.ignore" is read-only.␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_readonly_set␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## netlifyConfig properties are readonly (delete) by default

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_readonly_delete␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_readonly_delete␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_readonly_delete/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: test␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_readonly_delete␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Setting "netlifyConfig.build.command" to undefined is not allowed.␊
      Please set this property to a specific value instead.␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        command: test␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_readonly_delete␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## netlifyConfig properties are readonly (defineProperty) by default

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_readonly_define␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_readonly_define␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_readonly_define/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_readonly_define␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.ignore" value changed to ''.␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: "netlifyConfig.build.ignore" is read-only.␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_readonly_define␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Some netlifyConfig properties can be mutated

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_general␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_general␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_general/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_general␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./one␊
        - inputs: {}␊
          origin: config␊
          package: ./two␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./one@1.0.0 from netlify.toml␊
       - ./two@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./one (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.directory" value changed to 'test_functions'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_general␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_general/test_functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./one␊
        - inputs: {}␊
          origin: config␊
          package: ./two␊
    ␊
    (./one onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./one (onBuild event)                                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    packages/build/tests/plugins/fixtures/config_mutate_general/test_functions␊
    ␊
    (./one onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./two (onBuild event)                                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    packages/build/tests/plugins/fixtures/config_mutate_general/test_functions␊
    ␊
    (./two onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      4. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in test_functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig properties cannot be deleted

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_delete␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_delete␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_delete/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: test␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_delete␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onPreBuild event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Setting "netlifyConfig.build.command" to undefined is not allowed.␊
      Please set this property to a specific value instead.␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        command: test␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_delete␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## netlifyConfig properties cannot be assigned to undefined

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_set_undefined␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_set_undefined␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_set_undefined/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: test␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_set_undefined␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onPreBuild event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Setting "netlifyConfig.build.command" to undefined is not allowed.␊
      Please set this property to a specific value instead.␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        command: test␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_set_undefined␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## netlifyConfig properties cannot be assigned to null

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_set_null␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_set_null␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_set_null/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: test␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_set_null␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onPreBuild event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Setting "netlifyConfig.build.command" to null is not allowed.␊
      Please set this property to a specific value instead.␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        command: test␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_set_null␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## netlifyConfig properties cannot be assigned to undefined with defineProperty

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_define_undefined␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_define_undefined␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_define_undefined/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: test␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_define_undefined␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onPreBuild event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Setting "netlifyConfig.build.command" to undefined is not allowed.␊
      Please set this property to a specific value instead.␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        command: test␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_define_undefined␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## netlifyConfig properties mutations is persisted

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_persist␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_persist␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_persist/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_persist␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_persist␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from a plugin                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.*.external_node_modules" value changed to [ 'test' ].␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_persist␊
        publishOrigin: default␊
      functions:␊
        '*':␊
          external_node_modules:␊
            - test␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      4. ./plugin (onPostBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    node --version␊
    [ 'test' ]␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig array properties can be mutated per index

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_array_index␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_array_index␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_array_index/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_array_index␊
        publishOrigin: default␊
      functions:␊
        '*':␊
          included_files:␊
            - one␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.*.included_files" value changed to [ 'one', 'two' ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_array_index␊
        publishOrigin: default␊
      functions:␊
        '*':␊
          included_files:␊
            - one␊
            - two␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig array properties can be pushed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_array_push␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_array_push␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_array_push/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_array_push␊
        publishOrigin: default␊
      functions:␊
        '*':␊
          included_files:␊
            - one␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.*.included_files" value changed to [ 'one', 'two' ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_array_push␊
        publishOrigin: default␊
      functions:␊
        '*':␊
          included_files:␊
            - one␊
            - two␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.functionsDirectory mutations are used during functions bundling

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_bundling␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_bundling␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_bundling/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_bundling␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.directory" value changed to 'test_functions'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_bundling␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_bundling/test_functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in test_functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.functionsDirectory deletion skips functions bundling

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_skip␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_skip␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_skip/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_skip␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_skip/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    packages/build/tests/plugins/fixtures/config_mutate_functions_directory_skip/functions␊
    Netlify configuration property "functions.directory" value changed to ''.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_skip␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.functionsDirectory mutations are used by utils.functions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_utils␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_utils␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_utils/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_utils␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.directory" value changed to 'test_functions'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_utils␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_utils/test_functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from test_functions directory:␊
     - test.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.functionsDirectory mutations are used by constants.FUNCTIONS_SRC

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_constants␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_constants␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_constants/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_constants␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.directory" value changed to 'test_functions'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_constants␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_constants/test_functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test_functions␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in test_functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.functionsDirectory mutations are taken into account by default constants.FUNCTIONS_SRC

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_default␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_default␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_default/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_default␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_default/netlify/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify/functions␊
    Netlify configuration property "functions.directory" value changed to 'test_functions'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_default␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_default/test_functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test_functions␊
    Netlify configuration property "functions.directory" value changed to ''.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_default␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_default/netlify/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in netlify/functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      4. ./plugin (onPostBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify/functions␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.functions.star.directory mutations work

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.*.directory" value changed to 'test_functions'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star/test_functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star/test_functions␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in test_functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.functions.star.directory has priority over functions.directory

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star_priority␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star_priority␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star_priority/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star_priority␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star_priority/one␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.*.directory" value changed to 'test_functions'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star_priority␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star_priority/test_functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    packages/build/tests/plugins/fixtures/config_mutate_functions_directory_star_priority/test_functions␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in test_functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.functions.directory mutations work

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.directory" value changed to 'test_functions'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested/test_functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested/test_functions␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in test_functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.functions.directory has priority over functions.star.directory

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested_priority␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested_priority␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested_priority/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested_priority␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested_priority/one␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.directory" value changed to 'test_functions'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested_priority␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested_priority/test_functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    packages/build/tests/plugins/fixtures/config_mutate_functions_directory_nested_priority/test_functions␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in test_functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.build.functions mutations work

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_build␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_build␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_directory_build/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_build␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.functions" value changed to 'test_functions'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_build␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_directory_build/test_functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    packages/build/tests/plugins/fixtures/config_mutate_functions_directory_build/test_functions␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in test_functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.functions mutations are used during functions bundling

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_bundling␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_bundling␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_bundling/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_bundling␊
        publishOrigin: default␊
      functions:␊
        test:␊
          node_bundler: esbuild␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_bundling/netlify/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.test.node_bundler" value changed to 'zisi'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_bundling␊
        publishOrigin: default␊
      functions:␊
        test:␊
          node_bundler: zisi␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_bundling/netlify/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from netlify/functions directory:␊
     - test.js␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Dependencies installation error                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      A Netlify Function failed to require one of its dependencies.␊
      Please make sure it is present in the site's top-level "package.json".␊
    ␊
      In file "packages/build/tests/plugins/fixtures/config_mutate_functions_bundling/netlify/functions/test.js"␊
      Cannot find module 'does_not_exist'␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_bundling␊
        publishOrigin: default␊
      functions:␊
        test:␊
          node_bundler: zisi␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_bundling/netlify/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## netlifyConfig.functions mutations on any property can be used

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_any␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_any␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_any/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_any␊
        publishOrigin: default␊
      functions:␊
        test:␊
          node_bundler: esbuild␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_any/netlify/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.test.external_node_modules" value changed to [].␊
    Netlify configuration property "functions.test.ignored_node_modules" value changed to [].␊
    Netlify configuration property "functions.test.included_files" value changed to [].␊
    Netlify configuration property "functions.*.node_bundler" value changed to 'zisi'.␊
    Netlify configuration property "functions.*.external_node_modules" value changed to [].␊
    Netlify configuration property "functions.*.ignored_node_modules" value changed to [].␊
    Netlify configuration property "functions.*.included_files" value changed to [].␊
    Netlify configuration property "functions.node_bundler" value changed to 'zisi'.␊
    Netlify configuration property "functions.external_node_modules" value changed to [ 'test' ].␊
    Netlify configuration property "functions.ignored_node_modules" value changed to [ 'test' ].␊
    Netlify configuration property "functions.included_files" value changed to [ 'test' ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_any␊
        publishOrigin: default␊
      functions:␊
        '*':␊
          external_node_modules:␊
            - test␊
          ignored_node_modules:␊
            - test␊
          included_files:␊
            - test␊
          node_bundler: zisi␊
        test:␊
          external_node_modules: []␊
          ignored_node_modules: []␊
          included_files: []␊
          node_bundler: esbuild␊
      functionsDirectory: packages/build/tests/plugins/fixtures/config_mutate_functions_any/netlify/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in netlify/functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.functions mutations can add new functions configs

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_functions_new␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_new␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_new/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_new␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "functions.test" value changed to { included_files: [] }.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_functions_new␊
        publishOrigin: default␊
      functions:␊
        test:␊
          included_files: []␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.functions mutations are only logged in debug mode

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_no_log_debug␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_functions_no_log_debug/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig properties are deeply readonly by default

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_readonly_deep␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_readonly_deep␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_readonly_deep/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_readonly_deep␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "plugins" value changed to [␊
      { package: './plugin', origin: 'config', inputs: { example: true } }␊
    ].␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: "netlifyConfig.plugins" is read-only.␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_readonly_deep␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## netlifyConfig is updated when headers file is created by a plugin

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_create_headers_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_create_headers_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_create_headers_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    []␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_plugin␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: one␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [ { for: '/external/path', values: { test: 'one' } } ]␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig is updated when headers file is created by a plugin and publish was changed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_create_headers_plugin_dynamic␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_create_headers_plugin_dynamic␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_create_headers_plugin_dynamic/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_plugin_dynamic␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.publish" value changed to 'test'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_plugin_dynamic/test␊
        publishOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    []␊
    test␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_plugin_dynamic/test␊
        publishOrigin: inline␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: one␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onPostBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [ { for: '/external/path', values: { test: 'one' } } ]␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig is updated when headers file is created by a build command

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_create_headers_command␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_create_headers_command␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_create_headers_command/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node command.js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_command␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    []␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node command.js␊
    ␊
    > Updated config␊
      build:␊
        command: node command.js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_command␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: one␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [ { for: '/external/path', values: { test: 'one' } } ]␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig is updated when headers file is created by a build command and publish was changed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_create_headers_command_dynamic␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_create_headers_command_dynamic␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_create_headers_command_dynamic/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node command.js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_command_dynamic␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    []␊
    Netlify configuration property "build.publish" value changed to 'test'.␊
    ␊
    > Updated config␊
      build:␊
        command: node command.js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_command_dynamic/test␊
        publishOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node command.js␊
    ␊
    > Updated config␊
      build:␊
        command: node command.js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_command_dynamic/test␊
        publishOrigin: inline␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: one␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [ { for: '/external/path', values: { test: 'one' } } ]␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig is updated when redirects file is created by a plugin

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_create_redirects_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_create_redirects_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_create_redirects_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_create_redirects_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    []␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_create_redirects_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          to: /external/path␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      }␊
    ]␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig is updated when redirects file is created by a plugin and publish was changed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_create_redirects_plugin_dynamic␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_create_redirects_plugin_dynamic␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_create_redirects_plugin_dynamic/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_create_redirects_plugin_dynamic␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.publish" value changed to 'test'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_create_redirects_plugin_dynamic/test␊
        publishOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    []␊
    test␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_create_redirects_plugin_dynamic/test␊
        publishOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          to: /external/path␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onPostBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      }␊
    ]␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig is updated when redirects file is created by a build command

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_create_redirects_command␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_create_redirects_command␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_create_redirects_command/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node command.js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_create_redirects_command␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    []␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node command.js␊
    ␊
    > Updated config␊
      build:␊
        command: node command.js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_create_redirects_command␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          to: /external/path␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      }␊
    ]␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig is updated when redirects file is created by a build command and publish was changed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_create_redirects_command_dynamic␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_create_redirects_command_dynamic␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_create_redirects_command_dynamic/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node command.js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_create_redirects_command_dynamic␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    []␊
    Netlify configuration property "build.publish" value changed to 'test'.␊
    ␊
    > Updated config␊
      build:␊
        command: node command.js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_create_redirects_command_dynamic/test␊
        publishOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node command.js␊
    ␊
    > Updated config␊
      build:␊
        command: node command.js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_create_redirects_command_dynamic/test␊
        publishOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          to: /external/path␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      }␊
    ]␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.processing can be assigned all at once

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_processing_all␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_processing_all␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_processing_all/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        processing:␊
          css:␊
            bundle: false␊
            minify: false␊
          html:␊
            pretty_urls: false␊
          images:␊
            compress: false␊
          js:␊
            bundle: false␊
            minify: false␊
          skip_processing: false␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_processing_all␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.processing.css.bundle" value changed to true.␊
    Netlify configuration property "build.processing.css.minify" value changed to true.␊
    Netlify configuration property "build.processing.html.pretty_urls" value changed to true.␊
    Netlify configuration property "build.processing.images.compress" value changed to true.␊
    Netlify configuration property "build.processing.js.bundle" value changed to true.␊
    Netlify configuration property "build.processing.js.minify" value changed to true.␊
    Netlify configuration property "build.processing.skip_processing" value changed to true.␊
    ␊
    > Updated config␊
      build:␊
        processing:␊
          css:␊
            bundle: true␊
            minify: true␊
          html:␊
            pretty_urls: true␊
          images:␊
            compress: true␊
          js:␊
            bundle: true␊
            minify: true␊
          skip_processing: true␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_processing_all␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    {␊
      css: { bundle: true, minify: true },␊
      html: { pretty_urls: true },␊
      images: { compress: true },␊
      js: { bundle: true, minify: true },␊
      skip_processing: true␊
    }␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.processing can be assigned individually

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_processing_prop␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_processing_prop␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_processing_prop/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        processing:␊
          css:␊
            bundle: false␊
            minify: false␊
          html:␊
            pretty_urls: false␊
          images:␊
            compress: false␊
          js:␊
            bundle: false␊
            minify: false␊
          skip_processing: false␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_processing_prop␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.processing.css.bundle" value changed to true.␊
    Netlify configuration property "build.processing.css.minify" value changed to true.␊
    Netlify configuration property "build.processing.html.pretty_urls" value changed to true.␊
    Netlify configuration property "build.processing.images.compress" value changed to true.␊
    Netlify configuration property "build.processing.js.bundle" value changed to true.␊
    Netlify configuration property "build.processing.js.minify" value changed to true.␊
    Netlify configuration property "build.processing.skip_processing" value changed to true.␊
    ␊
    > Updated config␊
      build:␊
        processing:␊
          css:␊
            bundle: true␊
            minify: true␊
          html:␊
            pretty_urls: true␊
          images:␊
            compress: true␊
          js:␊
            bundle: true␊
            minify: true␊
          skip_processing: true␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_processing_prop␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    {␊
      css: { bundle: true, minify: true },␊
      html: { pretty_urls: true },␊
      images: { compress: true },␊
      js: { bundle: true, minify: true },␊
      skip_processing: true␊
    }␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.headers can be assigned all at once

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_headers_all␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_headers_all␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_headers_all/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_headers_all␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: one␊
      headersOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "headers" value changed to [␊
      { for: '/external/path', values: { test: 'one' } },␊
      { for: '/external/path', values: { test: 'two' } }␊
    ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_headers_all␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: one␊
        - for: /external/path␊
          values:␊
            test: two␊
      headersOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      { for: '/external/path', values: { test: 'one' } },␊
      { for: '/external/path', values: { test: 'two' } }␊
    ]␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.headers can be modified before headers file has been added

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_headers_before␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_headers_before␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_headers_before/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_headers_before␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: one␊
      headersOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "headers" value changed to [␊
      { for: '/external/path', values: { test: 'one' } },␊
      { for: '/external/path', values: { test: 'two' } }␊
    ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_headers_before␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: one␊
        - for: /external/path␊
          values:␊
            test: two␊
      headersOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_headers_before␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: three␊
        - for: /external/path␊
          values:␊
            test: one␊
        - for: /external/path␊
          values:␊
            test: two␊
      headersOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onPostBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      { for: '/external/path', values: { test: 'three' } },␊
      { for: '/external/path', values: { test: 'one' } },␊
      { for: '/external/path', values: { test: 'two' } }␊
    ]␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.headers can be modified after headers file has been added

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_headers_after␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_headers_after␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_headers_after/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_headers_after␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: three␊
        - for: /external/path␊
          values:␊
            test: one␊
      headersOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "headers" value changed to [␊
      { for: '/external/path', values: { test: 'three' } },␊
      { for: '/external/path', values: { test: 'one' } },␊
      { for: '/external/path', values: { test: 'two' } }␊
    ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_headers_after␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: three␊
        - for: /external/path␊
          values:␊
            test: one␊
        - for: /external/path␊
          values:␊
            test: two␊
      headersOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onPostBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      { for: '/external/path', values: { test: 'three' } },␊
      { for: '/external/path', values: { test: 'one' } },␊
      { for: '/external/path', values: { test: 'two' } }␊
    ]␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --saveConfig deletes headers file if headers were changed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/plugins/fixtures/config_save_headers/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_save_headers␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_save_headers␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_save_headers/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_save_headers␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: three␊
        - for: /external/path␊
          values:␊
            test: one␊
      headersOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "headers" value changed to [␊
      { for: '/external/path', values: { test: 'three' } },␊
      { for: '/external/path', values: { test: 'one' } },␊
      { for: '/external/path', values: { test: 'two' } }␊
    ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_save_headers␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: three␊
        - for: /external/path␊
          values:␊
            test: one␊
        - for: /external/path␊
          values:␊
            test: two␊
      headersOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onPostBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      { for: '/external/path', values: { test: 'three' } },␊
      { for: '/external/path', values: { test: 'one' } },␊
      { for: '/external/path', values: { test: 'two' } }␊
    ]␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      4. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [[headers]]␊
      for = "/external/path"␊
    ␊
        [headers.values]␊
        test = "three"␊
    ␊
      [[headers]]␊
      for = "/external/path"␊
    ␊
        [headers.values]␊
        test = "one"␊
    ␊
      [[headers]]␊
      for = "/external/path"␊
    ␊
        [headers.values]␊
        test = "two"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
    ␊
          [[context.production.headers]]␊
          for = "/external/path"␊
    ␊
            [context.production.headers.values]␊
            test = "three"␊
    ␊
          [[context.production.headers]]␊
          for = "/external/path"␊
    ␊
            [context.production.headers.values]␊
            test = "one"␊
    ␊
          [[context.production.headers]]␊
          for = "/external/path"␊
    ␊
            [context.production.headers.values]␊
            test = "two"␊
    ␊
        [context.main]␊
    ␊
          [[context.main.headers]]␊
          for = "/external/path"␊
    ␊
            [context.main.headers.values]␊
            test = "three"␊
    ␊
          [[context.main.headers]]␊
          for = "/external/path"␊
    ␊
            [context.main.headers.values]␊
            test = "one"␊
    ␊
          [[context.main.headers]]␊
          for = "/external/path"␊
    ␊
            [context.main.headers.values]␊
            test = "two"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --saveConfig deletes headers file if any configuration property was changed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/plugins/fixtures/config_delete_headers/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_delete_headers␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_delete_headers␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_delete_headers/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_delete_headers␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: three␊
        - for: /external/path␊
          values:␊
            test: one␊
      headersOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST␊
        publish: packages/build/tests/plugins/fixtures/config_delete_headers␊
        publishOrigin: default␊
      headers:␊
        - for: /external/path␊
          values:␊
            test: three␊
        - for: /external/path␊
          values:␊
            test: one␊
      headersOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
    ␊
        [build.environment]␊
        TEST = "test"␊
    ␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [[headers]]␊
      for = "/external/path"␊
    ␊
        [headers.values]␊
        test = "three"␊
    ␊
      [[headers]]␊
      for = "/external/path"␊
    ␊
        [headers.values]␊
        test = "one"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
    ␊
          [context.production.environment]␊
          TEST = "test"␊
    ␊
          [context.production.build]␊
    ␊
            [context.production.build.environment]␊
            TEST = "test"␊
    ␊
        [context.main]␊
    ␊
          [context.main.environment]␊
          TEST = "test"␊
    ␊
          [context.main.build]␊
    ␊
            [context.main.build.environment]␊
            TEST = "test"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Erroneous headers created by a build command are handled

> Snapshot 1

    `␊
    Warning: some headers have syntax errors:␊
    ␊
    Path should come before header "test"␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/plugins/fixtures/config_create_headers_command_error/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_create_headers_command_error␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: 'true'␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_create_headers_command_error␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_create_headers_command_error/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node command.js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_command_error␊
        publishOrigin: default␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node command.js␊
    ␊
    > Updated config␊
      build:␊
        command: node command.js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_command_error␊
        publishOrigin: default␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
      command = "node command.js"␊
    ␊
    > Uploaded headers␊
      test: one␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Erroneous headers created by a plugin are handled

> Snapshot 1

    `␊
    Warning: some headers have syntax errors:␊
    ␊
    Could not parse header number 1:␊
      {"values":{}}␊
    Missing "for" field␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/plugins/fixtures/config_create_headers_plugin_error/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_create_headers_plugin_error␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: 'true'␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_create_headers_plugin_error␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_create_headers_plugin_error/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_plugin_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "headers" value changed to [ { values: {} } ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_create_headers_plugin_error␊
        publishOrigin: default␊
      headersOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    []␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
    ␊
          [[context.production.headers]]␊
    ␊
            [context.production.headers.values]␊
    ␊
        [context.main]␊
    ␊
          [[context.main.headers]]␊
    ␊
            [context.main.headers.values]␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    ␊
    ␊
    Warning: some headers have syntax errors:␊
    ␊
    Could not parse header number 1:␊
      {"values":{}}␊
    Missing "for" field`

## netlifyConfig.redirects can be assigned all at once

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_redirects_all␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_redirects_all␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_redirects_all/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_redirects_all␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "redirects" value changed to [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      { from: '/external/path', to: '/external/path' }␊
    ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_redirects_all␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: inline␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      }␊
    ]␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.redirects can be modified before redirects file has been added

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_redirects_before␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_redirects_before␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_redirects_before/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_redirects_before␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "redirects" value changed to [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      { from: '/external/path', to: '/external/path' }␊
    ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_redirects_before␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: inline␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_redirects_before␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: inline␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onPostBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      }␊
    ]␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.redirects can be modified after redirects file has been added

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_redirects_after␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_redirects_after␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_redirects_after/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_redirects_after␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "redirects" value changed to [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      { from: '/external/path', to: '/external/path' }␊
    ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_redirects_after␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: inline␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      }␊
    ]␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --saveConfig deletes redirects file if redirects were changed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/plugins/fixtures/config_save_redirects/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_save_redirects␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_save_redirects␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_save_redirects/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_save_redirects␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          status: 200␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "redirects" value changed to [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        status: 200,␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      { from: '/external/path', to: '/external/path' }␊
    ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_save_redirects␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          status: 200␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: inline␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [[redirects]]␊
      from = "/external/path"␊
      to = "/external/path"␊
      status = 200␊
    ␊
      [[redirects]]␊
      from = "/external/path"␊
      to = "/external/path"␊
    ␊
      [[redirects]]␊
      from = "/external/path"␊
      to = "/external/path"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
    ␊
          [[context.production.redirects]]␊
          from = "/external/path"␊
          to = "/external/path"␊
          status = 200␊
    ␊
          [[context.production.redirects]]␊
          from = "/external/path"␊
          to = "/external/path"␊
    ␊
          [[context.production.redirects]]␊
          from = "/external/path"␊
          to = "/external/path"␊
    ␊
        [context.main]␊
    ␊
          [[context.main.redirects]]␊
          from = "/external/path"␊
          to = "/external/path"␊
          status = 200␊
    ␊
          [[context.main.redirects]]␊
          from = "/external/path"␊
          to = "/external/path"␊
    ␊
          [[context.main.redirects]]␊
          from = "/external/path"␊
          to = "/external/path"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      4. ./plugin (onSuccess event)                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        status: 200,␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      },␊
      {␊
        from: '/external/path',␊
        query: {},␊
        to: '/external/path',␊
        force: false,␊
        conditions: {},␊
        headers: {}␊
      }␊
    ]␊
    ␊
    (./plugin onSuccess completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --saveConfig deletes redirects file if any configuration property was changed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/plugins/fixtures/config_delete_redirects/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_delete_redirects␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_delete_redirects␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_delete_redirects/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_delete_redirects␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          status: 200␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST␊
        publish: packages/build/tests/plugins/fixtures/config_delete_redirects␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
      redirects:␊
        - from: /external/path␊
          status: 200␊
          to: /external/path␊
        - from: /external/path␊
          to: /external/path␊
      redirectsOrigin: config␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
    ␊
        [build.environment]␊
        TEST = "test"␊
    ␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [[redirects]]␊
      from = "/external/path"␊
      to = "/external/path"␊
      status = 200␊
    ␊
      [[redirects]]␊
      from = "/external/path"␊
      to = "/external/path"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
    ␊
          [context.production.environment]␊
          TEST = "test"␊
    ␊
          [context.production.build]␊
    ␊
            [context.production.build.environment]␊
            TEST = "test"␊
    ␊
        [context.main]␊
    ␊
          [context.main.environment]␊
          TEST = "test"␊
    ␊
          [context.main.build]␊
    ␊
            [context.main.build.environment]␊
            TEST = "test"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.build.command can be changed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_build_command_change␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_build_command_change␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_build_command_change/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: test␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_build_command_change␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_build_command_change␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from a plugin                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    node --version␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.build.command can be added

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_build_command_add␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_build_command_add␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_build_command_add/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_build_command_add␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_build_command_add␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from a plugin                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.build.command can be removed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_build_command_remove␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_build_command_remove␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_build_command_remove/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: test␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_build_command_remove␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to ''.␊
    ␊
    > Updated config␊
      build:␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_build_command_remove␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.build.environment can be assigned all at once

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_env_all␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_env_all␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_env_all/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        environment:␊
          - TEST_ONE␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_env_all␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST_TWO" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST_ONE␊
          - TEST_TWO␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_env_all␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    { TEST_ONE: 'one', TEST_TWO: 'two' }␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.build.environment can be assigned individually

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_env_prop␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_env_prop␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_env_prop/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        environment:␊
          - TEST_ONE␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_env_prop␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST_TWO" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST_ONE␊
          - TEST_TWO␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_env_prop␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    { TEST_ONE: 'one', TEST_TWO: 'two' }␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.build.publish mutations are used by constants.PUBLISH_DIR

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_publish_constants␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_publish_constants␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_publish_constants/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_publish_constants␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    .␊
    Netlify configuration property "build.publish" value changed to 'test'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_publish_constants/test␊
        publishOrigin: inline␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.build.edge_handlers mutations are used by constants.EDGE_HANDLERS_SRC

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_edge_handlers_constants␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_edge_handlers_constants␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_edge_handlers_constants/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_edge_handlers_constants␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    Netlify configuration property "build.edge_handlers" value changed to 'test'.␊
    ␊
    > Updated config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/config_mutate_edge_handlers_constants/test␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_edge_handlers_constants␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.edge_handlers can be assigned all at once

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_edge_handlers_all␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_edge_handlers_all␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_edge_handlers_all/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_edge_handlers_all␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "edge_handlers" value changed to [ { path: '/external/path', handler: 'two' } ].␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_edge_handlers_all␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [ { path: '/external/path', handler: 'two' } ]␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.services can be assigned all at once

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_services_all␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_services_all␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_services_all/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_services_all␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.services.identity" value changed to 'two'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_services_all␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    { identity: 'two' }␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig.services can be assigned individually

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_services_prop␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_services_prop␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_services_prop/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_services_prop␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.services.identity" value changed to 'two'.␊
    ␊
    > Updated config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_services_prop␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    { identity: 'two' }␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig mutations fail if done in an event that is too late

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_too_late␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_too_late␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_too_late/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_too_late␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: "netlifyConfig.build.command" cannot be modified after "onPreBuild".␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_too_late␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## netlifyConfig mutations fail correctly on symbols

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_symbol␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_symbol␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_symbol/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node --version␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_symbol␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## netlifyConfig mutations fail if the syntax is invalid

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_mutate_invalid_syntax␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_mutate_invalid_syntax␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_mutate_invalid_syntax/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_invalid_syntax␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to false.␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: When resolving config file packages/build/tests/plugins/fixtures/config_mutate_invalid_syntax/netlify.toml:␊
      Configuration property build.command must be a string␊
    ␊
      Invalid syntax␊
    ␊
        [build]␊
        command = false␊
    ␊
      Valid syntax␊
    ␊
        [build]␊
        command = "npm run build"␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_mutate_invalid_syntax␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## --saveConfig saves the configuration changes as netlify.toml

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/plugins/fixtures/config_save_changes/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_save_changes␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_save_changes␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_save_changes/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_save_changes␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/plugins/fixtures/config_save_changes␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from a plugin                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
      command = "node --version"␊
    ␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
        command = "node --version"␊
    ␊
          [context.production.build]␊
          command = "node --version"␊
    ␊
        [context.main]␊
        command = "node --version"␊
    ␊
          [context.main.build]␊
          command = "node --version"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --saveConfig is required to save the configuration changes as netlify.toml

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/plugins/fixtures/config_save_none/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_save_none␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_save_none␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_save_none/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_save_none␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/plugins/fixtures/config_save_none␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from a plugin                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --saveConfig creates netlify.toml if it does not exist

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_save_empty␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_save_empty␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_save_empty␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from Netlify app␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onPreBuild event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/plugins/fixtures/config_save_empty␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: ./plugin.js␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from a plugin                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
      command = "node --version"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
        command = "node --version"␊
    ␊
          [context.production.build]␊
          command = "node --version"␊
    ␊
        [context.main]␊
        command = "node --version"␊
    ␊
          [context.main.build]␊
          command = "node --version"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --saveConfig gives higher priority to configuration changes than context properties

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      config: packages/build/tests/plugins/fixtures/config_save_context/test_netlify.toml␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_save_context␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_save_context␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_save_context/test_netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: mainCommand␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/config_save_context␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/plugins/fixtures/config_save_context␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from a plugin                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
      command = "node --version"␊
    ␊
      [[plugins]]␊
      package = "./plugin"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
        command = "node --version"␊
    ␊
          [context.production.build]␊
          command = "node --version"␊
    ␊
        [context.main]␊
        command = "node --version"␊
    ␊
          [context.main.build]␊
          command = "node --version"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## --saveConfig is performed before deploy

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      branch: main␊
      buildbotServerSocket: /test/socket␊
      context: production␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_save_deploy␊
      saveConfig: true␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_save_deploy␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_save_deploy␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from Netlify app␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onPreBuild event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.command" value changed to 'node --version'.␊
    ␊
    > Updated config␊
      build:␊
        command: node --version␊
        commandOrigin: inline␊
        publish: packages/build/tests/plugins/fixtures/config_save_deploy␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: ./plugin.js␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from a plugin                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --version␊
    v1.0.0␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Uploaded config␊
      [build]␊
      command = "node --version"␊
    ␊
      [context]␊
    ␊
        [context.production]␊
        command = "node --version"␊
    ␊
          [context.production.build]␊
          command = "node --version"␊
    ␊
        [context.main]␊
        command = "node --version"␊
    ␊
          [context.main.build]␊
          command = "node --version"␊
    ␊
    > Uploaded headers␊
      No headers␊
    ␊
    > Uploaded redirects␊
      No redirects␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.CONFIG_PATH

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/config_path␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/config_path␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/config_path/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/config_path␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify.toml␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.PUBLISH_DIR default value

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/publish_default␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/publish_default␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/publish_default/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/publish_default␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    . true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.PUBLISH_DIR default value with build.base

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/publish_default_base␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/publish_default_base/base␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/publish_default_base/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        base: packages/build/tests/plugins/fixtures/publish_default_base/base␊
        publish: packages/build/tests/plugins/fixtures/publish_default_base/base␊
        publishOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: /external/path␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - /external/path from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. /external/path (onPreBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    . true␊
    ␊
    (/external/path onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.PUBLISH_DIR absolute path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/publish_absolute␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/publish_absolute␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/publish_absolute/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/publish_absolute/doesNotExist␊
        publishOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    doesNotExist␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.PUBLISH_DIR relative path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/publish_relative␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/publish_relative␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/publish_relative/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/publish_relative/publish␊
        publishOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    publish␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.PUBLISH_DIR missing path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/publish_missing␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/publish_missing␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/publish_missing/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/publish_missing/publish␊
        publishOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    publish false␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC default value

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_src_default␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_src_default␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_src_default/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_src_default␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC uses legacy default functions directory if it exists

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_src_legacy␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_src_legacy␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_src_legacy/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_src_legacy␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_src_legacy/netlify-automatic-functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify-automatic-functions␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in netlify-automatic-functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC ignores the legacy default functions directory if the new default directory exists

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_src_default_and_legacy␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_src_default_and_legacy␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_src_default_and_legacy/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_src_default_and_legacy␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_src_default_and_legacy/netlify/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify/functions␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in netlify/functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC relative path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_src_relative␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_src_relative␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_src_relative/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_src_relative␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_src_relative/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    functions␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC dynamic is ignored if FUNCTIONS_SRC is specified

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      functionsDirectory: /tmp-dir/test␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in test directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC dynamic should bundle Functions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in netlify/functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC automatic value

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_src_auto␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_src_auto␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_src_auto/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_src_auto␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC missing path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_src_missing␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_src_missing␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_src_missing/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_src_missing␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_src_missing/missing␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    missing false␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    The Netlify Functions setting targets a non-existing directory: missing␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_SRC created dynamically

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify/functions␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onPostBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.INTERNAL_FUNCTIONS_SRC default value

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/internal_functions_src_default␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/internal_functions_src_default␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/internal_functions_src_default/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/internal_functions_src_default␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    .netlify/functions-internal␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.FUNCTIONS_DIST

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_dist␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_dist␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_dist/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_dist␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    .netlify/functions/␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.CACHE_DIR local

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/cache␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/cache/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/cache␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    .netlify/cache␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.CACHE_DIR CI

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      cacheDir: /external/path␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/cache␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/cache/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/cache␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    /external/path␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.IS_LOCAL CI

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      mode: buildbot␊
      repositoryRoot: packages/build/tests/plugins/fixtures/is_local␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/is_local␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/is_local/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/is_local␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    false␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.SITE_ID

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/site_id␊
      siteId: test␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/site_id␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/site_id/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/site_id␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.IS_LOCAL local

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/is_local␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/is_local␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/is_local/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/is_local␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.NETLIFY_BUILD_VERSION

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/netlify_build_version␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/netlify_build_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/netlify_build_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/netlify_build_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    1.0.0␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.NETLIFY_API_TOKEN

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/netlify_api_token␊
      testOpts:␊
        env: false␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/netlify_api_token␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/netlify_api_token/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/netlify_api_token␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.NETLIFY_API_HOST

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      apiHost: test.api.netlify.com␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/netlify_api_host␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/netlify_api_host␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/netlify_api_host/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/netlify_api_host␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test.api.netlify.com␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.NETLIFY_API_HOST default value is set to api.netlify.com

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/netlify_api_host␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/netlify_api_host␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/netlify_api_host/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/netlify_api_host␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    api.netlify.com␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Pass packageJson to plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/package_json_valid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/package_json_valid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/package_json_valid/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/package_json_valid␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test_plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Pass empty packageJson to plugins if no package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Pass empty packageJson to plugins if package.json invalid

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/package_json_invalid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/package_json_invalid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/package_json_invalid/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/package_json_invalid␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions: missing source directory

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/missing␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/missing␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/missing/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/missing␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/missing/missing␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    The Netlify Functions setting targets a non-existing directory: missing␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions: must not be a regular file

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/regular_file␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/regular_file␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/regular_file/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/regular_file␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/regular_file/functions/test.js␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      The Netlify Functions setting should target a directory, not a regular file: functions/test.js␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/regular_file␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/regular_file/functions/test.js`

## Functions: can be a symbolic link

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/symlink␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/symlink␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/symlink/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/symlink␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/symlink/functions-link␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions-link directory:␊
     - test.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions: default directory

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/default␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/default␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/default/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/default␊
        publishOrigin: default␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions: simple setup

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/simple␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/simple␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/simple/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/simple␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/simple/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - test.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions: no functions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/none␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/none␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/none/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/none␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/none/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Functions were found in functions directory␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Functions: invalid package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_package_json_invalid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_package_json_invalid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_package_json_invalid/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_package_json_invalid␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_package_json_invalid/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - test.js␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      packages/build/tests/plugins/fixtures/functions_package_json_invalid/package.json is invalid JSON: packages/build/tests/plugins/fixtures/functions_package_json_invalid/package.json: Unexpected token { in JSON at position 1␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_package_json_invalid␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_package_json_invalid/functions`

## Functions: --functionsDistDir

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      functionsDistDir: /tmp-dir␊
      repositoryRoot: packages/build/tests/plugins/fixtures/simple␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/simple␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/simple/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/simple␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/simple/functions␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from functions directory:␊
     - test.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_HANDLERS_SRC default value

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/edge_handlers_src_default␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_default␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_default/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/edge_handlers_src_default␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_HANDLERS_SRC automatic value

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/edge_handlers_src_auto␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_auto␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_auto/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/edge_handlers_src_auto/netlify/edge-handlers␊
        publish: packages/build/tests/plugins/fixtures/edge_handlers_src_auto␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify/edge-handlers␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. @netlify/plugin-edge-handlers (onBuild event)              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Edge Handlers were found in netlify/edge-handlers directory␊
    ␊
    (@netlify/plugin-edge-handlers onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_HANDLERS_SRC relative path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/edge_handlers_src_relative␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_relative␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_relative/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/edge_handlers_src_relative/custom-edge-handlers␊
        publish: packages/build/tests/plugins/fixtures/edge_handlers_src_relative␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    custom-edge-handlers␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. @netlify/plugin-edge-handlers (onBuild event)              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Edge Handlers were found in custom-edge-handlers directory␊
    ␊
    (@netlify/plugin-edge-handlers onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_HANDLERS_SRC missing path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/edge_handlers_src_missing␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_missing␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/edge_handlers_src_missing/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/edge_handlers_src_missing/missing␊
        publish: packages/build/tests/plugins/fixtures/edge_handlers_src_missing␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    missing false␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. @netlify/plugin-edge-handlers (onBuild event)              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "@netlify/plugin-edge-handlers" failed                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Edge Handlers directory does not exist: packages/build/tests/plugins/fixtures/edge_handlers_src_missing/missing␊
    ␊
      Plugin details␊
      Package:        @netlify/plugin-edge-handlers␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/netlify-plugin-edge-handlers.git␊
      npm link:       https://www.npmjs.com/package/@netlify/plugin-edge-handlers␊
      Report issues:  https://github.com/netlify/netlify-plugin-edge-handlers/issues␊
    ␊
      Error location␊
      In "onBuild" event in "@netlify/plugin-edge-handlers" from core␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/edge_handlers_src_missing/missing␊
        publish: packages/build/tests/plugins/fixtures/edge_handlers_src_missing␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## constants.EDGE_HANDLERS_SRC created dynamically

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    netlify/edge-handlers␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onPostBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## constants.EDGE_HANDLERS_SRC dynamic is ignored if EDGE_HANDLERS_SRC is specified

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        edge_handlers: /tmp-dir/test␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. @netlify/plugin-edge-handlers (onBuild event)              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    No Edge Handlers were found in test directory␊
    ␊
    (@netlify/plugin-edge-handlers onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Edge handlers: simple setup

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/handlers_simple␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/handlers_simple␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/handlers_simple/netlify/edge-handlers␊
        publish: packages/build/tests/plugins/fixtures/handlers_simple␊
        publishOrigin: default␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. @netlify/plugin-edge-handlers (onBuild event)              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Handlers from netlify/edge-handlers directory:␊
     - test␊
    ␊
    (@netlify/plugin-edge-handlers onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Edge handlers: can configure directory

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/handlers_custom_dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/handlers_custom_dir␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/handlers_custom_dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        edge_handlers: packages/build/tests/plugins/fixtures/handlers_custom_dir/custom-edge-handlers␊
        publish: packages/build/tests/plugins/fixtures/handlers_custom_dir␊
        publishOrigin: default␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. @netlify/plugin-edge-handlers (onBuild event)              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Edge Handlers from custom-edge-handlers directory:␊
     - test␊
    ␊
    (@netlify/plugin-edge-handlers onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Deploy plugin succeeds

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      buildbotServerSocket: /test/socket␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/empty␊
        publishOrigin: default␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Site deploy was successfully initiated␊
    ␊
    (Deploy site completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Deploy plugin response syntax error

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      buildbotServerSocket: /test/socket␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/empty␊
        publishOrigin: default␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Internal error during "Deploy site"                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Invalid response from buildbot: SyntaxError: Unexpected token e in JSON at position 1␊
    ␊
      Error location␊
      During Deploy site␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/empty␊
        publishOrigin: default`

## Deploy plugin response system error

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      buildbotServerSocket: /test/socket␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/empty␊
        publishOrigin: default␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Internal error during "Deploy site"                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Deploy did not succeed: test␊
    ␊
      Error location␊
      During Deploy site␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/empty␊
        publishOrigin: default`

## Deploy plugin response user error

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      buildbotServerSocket: /test/socket␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/empty␊
        publishOrigin: default␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. Deploy site                                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Deploy did not succeed: test␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/empty␊
        publishOrigin: default`

## plugin.onSuccess is triggered on success

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/success_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/success_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/success_ok/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/success_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onSuccess event)                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onSuccess␊
    ␊
    (./plugin.js onSuccess completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onSuccess is not triggered on failure

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/success_not_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/success_not_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/success_not_ok/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/success_not_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/success_not_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onSuccess is not triggered on failPlugin()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/success_fail_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/success_fail_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/success_fail_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/success_fail_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" failed                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/success_fail_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onSuccess is not triggered on cancelBuild()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/success_cancel_build␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/success_cancel_build␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/success_cancel_build/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/success_cancel_build␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Build canceled by ./plugin.js                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      onBuild␊
    `

## plugin.onSuccess can fail but does not stop builds

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/success_fail␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/success_fail␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/success_fail/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/success_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onSuccess event)                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onSuccess␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onSuccess" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/success_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onError is not triggered on success

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_ok/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onError is triggered on failure

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_not_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_not_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_not_ok/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_not_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onError event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onError␊
    ␊
    (./plugin.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_not_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onError is not triggered on failPlugin()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_fail_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_fail_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_fail_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_fail_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" failed                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_fail_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onError is triggered on cancelBuild()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_cancel_build␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_cancel_build␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_cancel_build/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_cancel_build␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onError event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onError␊
    ␊
    (./plugin.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Build canceled by ./plugin.js                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      onBuild␊
    `

## plugin.onError can fail

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_fail␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_fail␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_fail/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onError event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onError␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onError" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onError gets an error argument

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_argument␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_argument␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_argument/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_argument␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onError event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    TestError␊
    test␊
    TestError: test␊
    STACK TRACE␊
    ␊
    (./plugin.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      TestError: test␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_argument␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onError can be used in several plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/error_several␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/error_several␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/error_several/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_several␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
       - ./handler_one.js@1.0.0 from netlify.toml␊
       - ./handler_two.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./handler_one.js (onError event)                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./handler_one.js" internal error                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onError␊
    ␊
      Plugin details␊
      Package:        ./handler_one.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onError" event in "./handler_one.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_several␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./handler_two.js (onError event)                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./handler_two.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/error_several␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js`

## plugin.onEnd is triggered on success

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_ok/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/end_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onEnd event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd␊
    ␊
    (./plugin.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onEnd is triggered on failure

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_not_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_not_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_not_ok/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/end_not_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onEnd event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd␊
    ␊
    (./plugin.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/end_not_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onEnd is not triggered on failPlugin()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_fail_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_fail_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_fail_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/end_fail_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" failed                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/end_fail_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onEnd is triggered on cancelBuild()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_cancel_build␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_cancel_build␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_cancel_build/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/end_cancel_build␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onEnd event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd␊
    ␊
    (./plugin.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Build canceled by ./plugin.js                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      onBuild␊
    `

## plugin.onEnd can fail but it does not stop builds

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_fail␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_fail␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_fail/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/end_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onEnd event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onEnd␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onEnd" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/end_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onEnd and plugin.onError can be used together

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_error␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_error␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_error/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/end_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onError event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onError␊
    ␊
    (./plugin.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin.js (onEnd event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd␊
    ␊
    (./plugin.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/end_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onEnd can be used in several plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/end_several␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/end_several␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/end_several/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/end_several␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
       - ./handler_one.js@1.0.0 from netlify.toml␊
       - ./handler_two.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./handler_one.js (onEnd event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd one␊
    ␊
    (./handler_one.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./handler_two.js (onEnd event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd two␊
    ␊
    (./handler_two.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/end_several␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js`

## Can use pure ES modules with local plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/es_modules_local␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/es_modules_local␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/es_modules_local/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/es_modules_local␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Local plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/local␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Local plugins directory

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local_dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local_dir␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local_dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/local_dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Local plugins absolute path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local_absolute␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local_absolute␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local_absolute/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/local_absolute␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: /external/path␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - /external/path from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. /external/path (onPreBuild event)                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (/external/path onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Local plugins invalid path

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local_invalid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local_invalid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local_invalid/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/local_invalid␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Plugin could not be found using local path: ./plugin␊
      Cannot find module './plugin'␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/local_invalid␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Node module plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/module␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/module␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/module/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/module␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from netlify.toml and package.json␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-test (onPreBuild event)                     ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## UI plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/ui␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/ui␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/ui␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from Netlify app and package.json␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-test (onPreBuild event)                     ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Resolution is relative to the build directory

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      config: packages/build/tests/plugins/fixtures/module_base/netlify.toml␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/module_base␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/module_base/base␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/module_base/base/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        base: packages/build/tests/plugins/fixtures/module_base/base␊
        publish: packages/build/tests/plugins/fixtures/module_base/base␊
        publishOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from netlify.toml and package.json␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-test (onPreBuild event)                     ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Non-existing plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/non_existing␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/non_existing␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/non_existing/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/non_existing␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: does-not-exist␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Plugins must be installed either in the Netlify App or in "package.json".␊
      Please run "npm install -D does-not-exist" or "yarn add -D does-not-exist".␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/non_existing␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: does-not-exist`

## Do not allow overriding core plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/core_override␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/core_override␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/core_override/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/core_override␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: '@netlify/plugin-edge-handlers'␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Install plugins in .netlify/plugins/ when not cached

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/valid_package␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/valid_package␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/valid_package/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/valid_package␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Use plugins cached in .netlify/plugins/

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_cache␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Do not use plugins cached in .netlify/plugins/ if outdated

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache_outdated␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache_outdated␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache_outdated/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_cache_outdated␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Fetches the list of plugin versions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_cache␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Only prints the list of plugin versions in verbose mode

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Uses fallback when the plugins fetch fails

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_cache␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    Warning: could not fetch latest plugins list. Plugins versions might not be the latest.␊
    Response code 500 (Internal Server Error)␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Uses fallback when the plugins fetch succeeds with an invalid response

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_cache␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    Warning: could not fetch latest plugins list. Plugins versions might not be the latest.␊
    Request succeeded but with an invalid response:␊
    {␊
      "error": "test"␊
    }␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Can execute local binaries when using .netlify/plugins/

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache_bin␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache_bin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache_bin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_cache_bin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    1.0.0␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Can require site dependencies when using .netlify/plugins/

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache_site_deps␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache_site_deps␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache_site_deps/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_cache_site_deps␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Works with .netlify being a regular file

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache_regular_file␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache_regular_file␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache_regular_file/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_cache_regular_file␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Print a warning when using plugins not in plugins.json nor package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/invalid_package␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/invalid_package␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/invalid_package/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/invalid_package␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: power-cartesian-product␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    `

## Can use local plugins even when some plugins are cached

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_cache_local␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_cache_local␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_cache_local/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_cache_local␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onPostBuild event)                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin.js onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Prints outdated plugins installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_outdated_package_json␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_outdated_package_json␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_outdated_package_json/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_outdated_package_json␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml and package.json (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please update its version in "package.json"␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Prints incompatible plugins installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_incompatible_package_json␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_incompatible_package_json␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_incompatible_package_json/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_incompatible_package_json␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 1-0-0 from netlify.toml and package.json (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Incompatible plugins␊
       - netlify-plugin-contextual-env 1-0-0: version 1.0.0 is the most recent version compatible with Node.js <100␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not print incompatible plugins installed in package.json if major version is same

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_incompatible_package_json_same_major␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_incompatible_package_json_same_major␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_incompatible_package_json_same_major/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_incompatible_package_json_same_major␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-4-0 from netlify.toml and package.json (latest 0-4-0, expected 0-4-1, compatible 0-4-1)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not print incompatible plugins installed in package.json if not using the compatibility field

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_incompatible_package_json␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_incompatible_package_json␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_incompatible_package_json/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_incompatible_package_json␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 1-0-0 from netlify.toml and package.json (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify non-matching compatibility.nodeVersion

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-1-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-1-0 from netlify.toml (latest 0-3-0, expected 0-1-0, compatible 0-1-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-1-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins ignore compatibility entries without conditions unless pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-1-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-1-0 from netlify.toml (latest 0-3-0, expected 0-1-0, compatible 0-1-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-1-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins does not ignore compatibility entries without conditions if pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (pinned 0-2-0, latest 0-3-0, expected 0-2-0, compatible 0-3-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins ignore compatibility conditions if pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (pinned 0-2-0, latest 0-3-0, expected 0-2-0, compatible 0-3-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify matching compatibility.nodeVersion

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins compatibility defaults to version field

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify compatibility.migrationGuide

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-1-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-1-0 from netlify.toml (latest 0-3-0, expected 0-1-0, compatible 0-1-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-1-0: latest version is 0-3-0␊
         Migration guide: http://test.com␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify matching compatibility.siteDependencies

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify non-matching compatibility.siteDependencies

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify non-existing compatibility.siteDependencies

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify multiple non-matching compatibility conditions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify multiple matching compatibility conditions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify non-matching compatibility.siteDependencies range

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies_range␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies_range␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies_range/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_site_dependencies_range␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugin versions can be feature flagged

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugin versions that are feature flagged are ignored if no matching feature flag

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-2-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugin pinned versions that are feature flagged are not ignored if pinned but no matching feature flag

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (pinned 0-3-0, latest 0-2-0, expected 0-3-0, compatible 0-2-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Compatibility order take precedence over the `featureFlag` property

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Pin plugin versions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
      {
        body: {
          pinned_version: '0.3',
        },
        headers: 'accept accept-encoding authorization connection content-length content-type host user-agent',
        method: 'PUT',
        url: '/api/v1/sites/test/plugins/netlify-plugin-contextual-env',
      },
    ]

## Report updatePlugin API error without failing the build

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      API error on "updatePlugin"                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Bad Request␊
    ␊
      Error location␊
      While calling the Netlify API endpoint 'updatePlugin' with:␊
      {␊
        "package": "netlify-plugin-contextual-env",␊
        "site_id": "test",␊
        "body": {␊
          "pinned_version": "0.3"␊
        }␊
      }␊
    ␊
      Error properties␊
      { name: 'JSONHTTPError', status: 400, json: {} }␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
      {
        body: {
          pinned_version: '0.3',
        },
        headers: 'accept accept-encoding authorization connection content-length content-type host user-agent',
        method: 'PUT',
        url: '/api/v1/sites/test/plugins/netlify-plugin-contextual-env',
      },
    ]

## Does not report 404 updatePlugin API error

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
      {
        body: {
          pinned_version: '0.3',
        },
        headers: 'accept accept-encoding authorization connection content-length content-type host user-agent',
        method: 'PUT',
        url: '/api/v1/sites/test/plugins/netlify-plugin-contextual-env',
      },
    ]

## Only pin plugin versions in production

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: false␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Do not pin plugin versions without an API token

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Do not pin plugin versions without a siteId

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Do not pin plugin versions if the build failed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_build_failed␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_build_failed␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_build_failed/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node --invalid␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/pin_build_failed␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --invalid␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      "build.command" failed                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Command failed with exit code 9: node --invalid␊
    ␊
      Error location␊
      In build.command from netlify.toml:␊
      node --invalid␊
    ␊
      Resolved config␊
      build:␊
        command: node --invalid␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/pin_build_failed␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    node: bad option: --invalid`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Do not pin plugin versions if the plugin failed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_plugin_failed␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_plugin_failed␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_plugin_failed␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "netlify-plugin-contextual-env" failed                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: test␊
    ␊
      Plugin details␊
      Package:        netlify-plugin-contextual-env␊
      Version:        1.0.0␊
      Repository:     test␊
      npm link:       https://www.npmjs.com/package/netlify-plugin-contextual-env␊
    ␊
      Error location␊
      In "onPreBuild" event in "netlify-plugin-contextual-env" from Netlify app␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_plugin_failed␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Do not pin plugin versions if the build was installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_module␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_module␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_module/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_module␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from netlify.toml and package.json␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-test (onPreBuild event)                     ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Do not pin plugin versions if already pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (pinned 0, latest 1-0-0, expected 0, compatible 1-0-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-3-0: latest version is 1-0-0␊
         To upgrade this plugin, please uninstall and re-install it from the Netlify plugins directory (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Pinning plugin versions takes into account the compatibility field

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (pinned 0, latest 1-0-0, expected 0-3-0, compatible 100-0-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-3-0: latest version is 1-0-0␊
         To upgrade this plugin, please uninstall and re-install it from the Netlify plugins directory (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Pin netlify.toml-only plugin versions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (pinned 0.3, latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding authorization connection host user-agent',
        method: 'GET',
        url: '/api/v1/sites/test/plugin_runs/latest?packages%5B%5D=netlify-plugin-contextual-env&state=success',
      },
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if there are no matching plugin runs

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding authorization connection host user-agent',
        method: 'GET',
        url: '/api/v1/sites/test/plugin_runs/latest?packages%5B%5D=netlify-plugin-contextual-env&state=success',
      },
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if there are no plugin runs

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding authorization connection host user-agent',
        method: 'GET',
        url: '/api/v1/sites/test/plugin_runs/latest?packages%5B%5D=netlify-plugin-contextual-env&state=success',
      },
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if there are no matching plugin runs version

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding authorization connection host user-agent',
        method: 'GET',
        url: '/api/v1/sites/test/plugin_runs/latest?packages%5B%5D=netlify-plugin-contextual-env&state=success',
      },
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Fails the build when pinning netlify.toml-only plugin versions and the API request fails

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      API error on "getLatestPluginRuns"                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Bad Request␊
    ␊
      Error location␊
      While calling the Netlify API endpoint 'getLatestPluginRuns' with:␊
      {␊
        "site_id": "test",␊
        "packages": [␊
          "netlify-plugin-contextual-env"␊
        ],␊
        "state": "success"␊
      }␊
    ␊
      Error properties␊
      {␊
        name: 'JSONHTTPError',␊
        status: 400,␊
        json: [ { package: 'netlify-plugin-contextual-env', version: '1.0.0' } ]␊
      }␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding authorization connection host user-agent',
        method: 'GET',
        url: '/api/v1/sites/test/plugin_runs/latest?packages%5B%5D=netlify-plugin-contextual-env&state=success',
      },
    ]

## Does not pin netlify.toml-only plugin versions if already pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (pinned 0, latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if installed in UI

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_ui␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_ui␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_config_ui␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_module␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_module␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_module/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_config_module␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 1-0-1 from netlify.toml and package.json (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if there are no API token

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Does not pin netlify.toml-only plugin versions if there are no site ID

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/pin_config_success␊
      sendStatus: true␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

> Snapshot 2

    [
      {
        body: '',
        headers: 'accept accept-encoding connection host user-agent',
        method: 'GET',
        url: '/',
      },
    ]

## Validate --node-path unsupported version does not fail when no plugins are used

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/plugins/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/empty␊
        publishOrigin: default␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Validate --node-path version is supported by the plugin

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/plugins/fixtures/engines␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/engines␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/engines/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/engines␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      The Node.js version is 1.0.0 but the plugin "./plugin.js" requires >=1.0.0␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/engines␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## Validate --node-path exists

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/plugins/fixtures/node_version_simple␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/node_version_simple␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/node_version_simple/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/node_version_simple␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Invalid --node-path CLI flag: /external/path␊
    `

## Provided --node-path version is unused in buildbot for local plugin executions if older than supported version

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      mode: buildbot␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/plugins/fixtures/version_greater_than_minimum␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/version_greater_than_minimum␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/version_greater_than_minimum/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/version_greater_than_minimum␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onPreBuild event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can execute local binaries

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local_bin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local_bin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local_bin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/local_bin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugin output can interleave stdout and stderr

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/interleave␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/interleave␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/interleave/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/interleave␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    three␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    ␊
    two`

## Plugins can have inputs

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/inputs␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/inputs␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/inputs/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/inputs␊
        publishOrigin: default␊
      plugins:␊
        - inputs:␊
            test: true␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## process.env changes are propagated to other plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/env_changes_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin_two␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
       - ./plugin_two@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin_two (onPreBuild event)                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin_two onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      4. ./plugin_two (onBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin_two onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      5. ./plugin (onPostBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined twoChanged en_US.UTF-8␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## process.env changes are propagated to onError and onEnd

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_on_error␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_on_error␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_on_error/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/env_changes_on_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onError event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    (./plugin onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      4. ./plugin (onEnd event)                                     ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    (./plugin onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/env_changes_on_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## process.env changes are propagated to build.command

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_command␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_command␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_command/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node print_env1.0.0js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/env_changes_command␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node print_env1.0.0js␊
    one two en_US.UTF-8 undefined␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## build.environment changes are propagated to other plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_build_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_build_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_build_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin_two␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
       - ./plugin_two@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST_ONE" value changed.␊
    Netlify configuration property "build.environment.TEST_TWO" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST_ONE␊
          - TEST_TWO␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin_two␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin_two (onPreBuild event)                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin_two onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      4. ./plugin_two (onBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    Netlify configuration property "build.environment.TEST_ONE" value changed.␊
    Netlify configuration property "build.environment.TEST_TWO" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST_ONE␊
          - TEST_TWO␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin_two␊
    ␊
    (./plugin_two onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      5. ./plugin (onPostBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
     twoChanged en_US.UTF-8␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## build.environment changes are propagated to onError and onEnd

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_build_on_error␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_build_on_error␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_build_on_error/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_on_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST_ONE" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST_ONE␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_on_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin (onError event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    (./plugin onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      4. ./plugin (onEnd event)                                     ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    (./plugin onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        environment:␊
          - TEST_ONE␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_on_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## build.environment changes are propagated to build.command

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_build_command␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_build_command␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_build_command/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node print_env1.0.0js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_command␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST_ONE" value changed.␊
    Netlify configuration property "build.environment.TEST_TWO" value changed.␊
    Netlify configuration property "build.environment.LANGUAGE" value changed.␊
    ␊
    > Updated config␊
      build:␊
        command: node print_env1.0.0js␊
        commandOrigin: config␊
        environment:␊
          - TEST_ONE␊
          - TEST_TWO␊
          - LANGUAGE␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_command␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node print_env1.0.0js␊
    one two en_US.UTF-8 ␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## build.environment and process.env changes can be mixed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_build_mix␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_build_mix␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_build_mix/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_mix␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST_ONE" value changed.␊
    Netlify configuration property "build.environment.TEST_TWO" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST_ONE␊
          - TEST_TWO␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_mix␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one_environment two␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Expose some utils

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/keys␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/keys␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/keys/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/keys␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    build cache functions git run status␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Utils are defined

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/defined␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/defined␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/defined/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/defined␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    getCacheDir has list remove restore save␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Can run utils

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_add␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_add␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_add/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_add␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_add/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    The Netlify Functions setting targets a non-existing directory: functions␊
    ␊
    Packaging Functions from .netlify/functions-internal directory:␊
     - test/test.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Can run list util

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_list␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_list␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_list/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_list␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_list/netlify/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      {␊
        "name": "internal_1",␊
        "mainFile": "packages/build/tests/plugins/fixtures/functions_list/.netlify/functions-internal/internal_1.js",␊
        "runtime": "js",␊
        "extension": ".js"␊
      },␊
      {␊
        "name": "user_1",␊
        "mainFile": "packages/build/tests/plugins/fixtures/functions_list/netlify/functions/user_1.js",␊
        "runtime": "js",␊
        "extension": ".js"␊
      }␊
    ]␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. Functions bundling                                         ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from .netlify/functions-internal directory:␊
     - internal_1.js␊
    ␊
    Packaging Functions from netlify/functions directory:␊
     - user_1.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Git utils fails if no root

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Invalid head commit HEAD␊
      Command failed with exit code 128: git rev-parse HEAD␊
      fatal: not a git repository (or any of the parent directories): .git␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Git utils does not fail if no root and not used

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    build cache functions git run status␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Validate plugin is an object

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/object␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/object␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/object/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/object␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Plugin must be an object or a function␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      While loading "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/object␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Validate plugin event handler names

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/handler_name␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/handler_name␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/handler_name/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/handler_name␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Invalid event 'onInvalid'.␊
      Please use a valid event name. One of:␊
       - onPreBuild␊
       - onBuild␊
       - onPostBuild␊
       - onSuccess␊
       - onError␊
       - onEnd␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      While loading "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/handler_name␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Validate plugin event handler function

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/handler_function␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/handler_function␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/handler_function/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/handler_function␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      TypeError: Invalid event handler 'onBuild': must be a function␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      While loading "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/handler_function␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Transpile TypeScript local plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/ts_transpile␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/ts_transpile␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/ts_transpile/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/ts_transpile␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.ts␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.ts@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.ts (onPreBuild event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin.ts onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Type-checks TypeScript local plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/ts_type_check␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/ts_type_check␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/ts_type_check/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/ts_type_check␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.ts␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.ts@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.ts" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Could not import plugin:␊
      TSError: ⨯ Unable to compile TypeScript:␊
      plugin.ts(8,3): error TS2554: Expected 1-2 arguments, but got 0.␊
    ␊
      TypeScript configuration␊
      compilerOptions:␊
        declaration: false␊
        esModuleInterop: true␊
        forceConsistentCasingInFileNames: true␊
        inlineSourceMap: false␊
        inlineSources: true␊
        lib:␊
          - es2000␊
        module: commonjs␊
        noEmit: false␊
        outDir: .ts-node␊
        skipLibCheck: true␊
        sourceMap: true␊
        strict: true␊
        target: es2000␊
        types:␊
          - node␊
      tsNodeOptions:␊
        optionBasePaths: {}␊
        require: []␊
    ␊
      Plugin details␊
      Package:        ./plugin.ts␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      While loading "./plugin.ts" from netlify.toml␊
    STACK TRACE␊
    ␊
      Error properties␊
      {␊
        diagnosticText: 'plugin.ts(8,3): error TS2554: Expected 1-2 arguments, but got 0./n',␊
        diagnosticCodes: [ 2554 ]␊
      }␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/ts_type_check␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.ts`

## Type-checks TypeScript local plugins using tsconfig.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/ts_type_check_tsconfig␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/ts_type_check_tsconfig␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/ts_type_check_tsconfig/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/ts_type_check_tsconfig␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.ts␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.ts@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.ts (onPreBuild event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined␊
    ␊
    (./plugin.ts onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not transpile already transpiled local plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/ts_transpile_already␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/ts_transpile_already␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/ts_transpile_already/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/ts_transpile_already␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    JavaScript␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`
