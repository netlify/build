# Snapshot report for `tests/plugins/tests.js`

The actual snapshot is saved in `tests.js.snap`.

Generated by [AVA](https://avajs.dev).

## Pass packageJson to plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/package_json_valid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/package_json_valid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/package_json_valid/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/package_json_valid␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test_plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Pass empty packageJson to plugins if no package.json

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.mjs␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.mjs from netlify.toml␊
    ␊
    ./plugin.mjs (onPreBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin.mjs onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.mjs onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Pass empty packageJson to plugins if package.json invalid

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/package_json_invalid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/package_json_invalid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/package_json_invalid/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/package_json_invalid␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Can use pure ES modules with local plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/es_modules_local␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/es_modules_local␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/es_modules_local/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/es_modules_local␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Can use pure ES modules with module plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/es_modules_module␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/es_modules_module␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/es_modules_module/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/es_modules_module␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from netlify.toml and package.json␊
    ␊
    netlify-plugin-test (onPreBuild event)                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    Build step duration: netlify-plugin-test onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Can use CommonJS with local plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/commonjs_local␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/commonjs_local␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/commonjs_local/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/commonjs_local␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.cjs␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.cjs@1.0.0 from netlify.toml␊
    ␊
    ./plugin.cjs (onPreBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin.cjs onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.cjs onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Local plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/local␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Local plugins directory

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local_dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local_dir␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local_dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/local_dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Local plugins absolute path

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local_absolute␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local_absolute␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local_absolute/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/local_absolute␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: /external/path␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - /external/path from netlify.toml␊
    ␊
    /external/path (onPreBuild event)                                    ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (/external/path onPreBuild completed in 1ms)␊
    Build step duration: /external/path onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Local plugins invalid path

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local_invalid␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local_invalid␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local_invalid/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/local_invalid␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Plugin could not be found using local path: ./plugin␊
      Cannot find module './plugin'␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/local_invalid␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Node module plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/module␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/module␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/module/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/module␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from netlify.toml and package.json␊
    ␊
    netlify-plugin-test (onPreBuild event)                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    Build step duration: netlify-plugin-test onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## UI plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/ui␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/ui␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/ui␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from Netlify app and package.json␊
    ␊
    netlify-plugin-test (onPreBuild event)                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    Build step duration: netlify-plugin-test onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Resolution is relative to the build directory

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      config: packages/build/tests/plugins/fixtures/module_base/netlify.toml␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/module_base␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/module_base/base␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/module_base/base/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        base: packages/build/tests/plugins/fixtures/module_base/base␊
        publish: packages/build/tests/plugins/fixtures/module_base/base␊
        publishOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from netlify.toml and package.json␊
    ␊
    netlify-plugin-test (onPreBuild event)                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    Build step duration: netlify-plugin-test onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Non-existing plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/non_existing␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/non_existing␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/non_existing/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/non_existing␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: does-not-exist␊
    ␊
    > Context␊
      production␊
    ␊
    Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Plugins must be installed either in the Netlify App or in "package.json".␊
      Please run "npm install -D does-not-exist" or "yarn add -D does-not-exist".␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/non_existing␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: does-not-exist`

## Do not allow overriding core plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/core_override␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/core_override␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/core_override/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/core_override␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: '@netlify/plugin-edge-handlers'␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Validate --node-path unsupported version does not fail when no plugins are used

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/plugins/fixtures/empty␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/empty␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/empty/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/empty␊
        publishOrigin: default␊
    ␊
    > Context␊
      production␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Validate --node-path version is supported by the plugin

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/plugins/fixtures/engines␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/engines␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/engines/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/engines␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      The Node.js version is 1.0.0 but the plugin "./plugin.js" requires >=1.0.0␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/engines␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## Validate --node-path exists

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/plugins/fixtures/node_version_simple␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/node_version_simple␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/node_version_simple/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/node_version_simple␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    Configuration error                                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Invalid --node-path CLI flag: /external/path␊
    `

## Provided --node-path version is unused in buildbot for local plugin executions if older than supported version

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      mode: buildbot␊
      nodePath: /external/path␊
      repositoryRoot: packages/build/tests/plugins/fixtures/version_greater_than_minimum␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/version_greater_than_minimum␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/version_greater_than_minimum/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/version_greater_than_minimum␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Warning: ./plugin.js will be executed with Node.js version 1.0.0␊
      The plugin cannot be executed with your defined Node.js version 1.0.0␊
    ␊
      Read more about our minimum required version in our forums announcement (https://answers.netlify.com/t/build-plugins-dropping-support-for-node-js-12/79421)␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ./plugin.js (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.js onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Plugins can execute local binaries

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/local_bin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/local_bin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/local_bin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/local_bin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Plugin output can interleave stdout and stderr

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/interleave␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/interleave␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/interleave/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/interleave␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    three␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms␊
    ␊
    two`

## Plugins can have inputs

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/inputs␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/inputs␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/inputs/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/inputs␊
        publishOrigin: default␊
      plugins:␊
        - inputs:␊
            test: true␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## process.env changes are propagated to other plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/env_changes_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin_two␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
       - ./plugin_two@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    ./plugin_two (onPreBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin_two onPreBuild completed in 1ms)␊
    Build step duration: ./plugin_two onPreBuild completed in 1ms␊
    ␊
    ./plugin (onBuild event)                                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    Build step duration: ./plugin onBuild completed in 1ms␊
    ␊
    ./plugin_two (onBuild event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin_two onBuild completed in 1ms)␊
    Build step duration: ./plugin_two onBuild completed in 1ms␊
    ␊
    ./plugin (onPostBuild event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined twoChanged en_US.UTF-8␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    Build step duration: ./plugin onPostBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## process.env changes are propagated to onError and onEnd

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_on_error␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_on_error␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_on_error/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/env_changes_on_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    ./plugin (onBuild event)                                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    ./plugin (onError event)                                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    (./plugin onError completed in 1ms)␊
    Build step duration: ./plugin onError completed in 1ms␊
    ␊
    ./plugin (onEnd event)                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    (./plugin onEnd completed in 1ms)␊
    Build step duration: ./plugin onEnd completed in 1ms␊
    ␊
    Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/env_changes_on_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## process.env changes are propagated to build.command

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_command␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_command␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_command/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node print_env1.0.0js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/env_changes_command␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    build.command from netlify.toml                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node print_env1.0.0js␊
    one two en_US.UTF-8 undefined␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## build.environment changes are propagated to other plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_build_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_build_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_build_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin_two␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
       - ./plugin_two@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST_ONE" value changed.␊
    Netlify configuration property "build.environment.TEST_TWO" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST_ONE␊
          - TEST_TWO␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin_two␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    ./plugin_two (onPreBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin_two onPreBuild completed in 1ms)␊
    Build step duration: ./plugin_two onPreBuild completed in 1ms␊
    ␊
    ./plugin (onBuild event)                                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    Build step duration: ./plugin onBuild completed in 1ms␊
    ␊
    ./plugin_two (onBuild event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one two en_US.UTF-8␊
    Netlify configuration property "build.environment.TEST_ONE" value changed.␊
    Netlify configuration property "build.environment.TEST_TWO" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST_ONE␊
          - TEST_TWO␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin_two␊
    ␊
    (./plugin_two onBuild completed in 1ms)␊
    Build step duration: ./plugin_two onBuild completed in 1ms␊
    ␊
    ./plugin (onPostBuild event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
     twoChanged en_US.UTF-8␊
    ␊
    (./plugin onPostBuild completed in 1ms)␊
    Build step duration: ./plugin onPostBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## build.environment changes are propagated to onError and onEnd

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_build_on_error␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_build_on_error␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_build_on_error/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_on_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST_ONE" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST_ONE␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_on_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    ./plugin (onBuild event)                                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    ./plugin (onError event)                                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    (./plugin onError completed in 1ms)␊
    Build step duration: ./plugin onError completed in 1ms␊
    ␊
    ./plugin (onEnd event)                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one␊
    ␊
    (./plugin onEnd completed in 1ms)␊
    Build step duration: ./plugin onEnd completed in 1ms␊
    ␊
    Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        environment:␊
          - TEST_ONE␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_on_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## build.environment changes are propagated to build.command

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_build_command␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_build_command␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_build_command/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node print_env1.0.0js␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_command␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST_ONE" value changed.␊
    Netlify configuration property "build.environment.TEST_TWO" value changed.␊
    Netlify configuration property "build.environment.LANGUAGE" value changed.␊
    ␊
    > Updated config␊
      build:␊
        command: node print_env1.0.0js␊
        commandOrigin: config␊
        environment:␊
          - TEST_ONE␊
          - TEST_TWO␊
          - LANGUAGE␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_command␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    build.command from netlify.toml                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node print_env1.0.0js␊
    one two en_US.UTF-8 ␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## build.environment and process.env changes can be mixed

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/env_changes_build_mix␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/env_changes_build_mix␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/env_changes_build_mix/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_mix␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Netlify configuration property "build.environment.TEST_ONE" value changed.␊
    Netlify configuration property "build.environment.TEST_TWO" value changed.␊
    ␊
    > Updated config␊
      build:␊
        environment:␊
          - TEST_ONE␊
          - TEST_TWO␊
        publish: packages/build/tests/plugins/fixtures/env_changes_build_mix␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    ./plugin (onBuild event)                                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    one_environment two␊
    ␊
    (./plugin onBuild completed in 1ms)␊
    Build step duration: ./plugin onBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Expose some utils

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/keys␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/keys␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/keys/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/keys␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.mjs␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.mjs@1.0.0 from netlify.toml␊
    ␊
    ./plugin.mjs (onPreBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    build cache functions git run status␊
    ␊
    (./plugin.mjs onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.mjs onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Utils are defined

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/defined␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/defined␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/defined/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/defined␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    getCacheDir has list remove restore save␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Can run utils

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_add␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_add␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_add/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_add␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_add/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Functions bundling                                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    The Netlify Functions setting targets a non-existing directory: functions␊
    ␊
    Packaging Functions from .netlify/functions-internal directory:␊
     - test/test.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    Build step duration: Functions bundling completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Cache utils are caching .dot directories as well

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/cache_utils␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/cache_utils␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/cache_utils/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node build.mjs␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins/fixtures/cache_utils␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: /external/path␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - /external/path from netlify.toml␊
    ␊
    /external/path (onPreBuild event)                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (/external/path onPreBuild completed in 1ms)␊
    Build step duration: /external/path onPreBuild completed in 1ms␊
    ␊
    build.command from netlify.toml                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node build.mjs␊
    content inside dist/.dot:␊
    hello.txt␊
    content inside dist/other:␊
    index.html␊
    Generate files␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    ␊
    /external/path (onPostBuild event)                     ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    (/external/path onPostBuild completed in 1ms)␊
    Build step duration: /external/path onPostBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Can run list util

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/functions_list␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/functions_list␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/functions_list/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/functions_list␊
        publishOrigin: default␊
      functionsDirectory: packages/build/tests/plugins/fixtures/functions_list/netlify/functions␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    [␊
      {␊
        "extension": ".js",␊
        "mainFile": "packages/build/tests/plugins/fixtures/functions_list/.netlify/functions-internal/internal_1.js",␊
        "name": "internal_1",␊
        "runtime": "js"␊
      },␊
      {␊
        "extension": ".js",␊
        "mainFile": "packages/build/tests/plugins/fixtures/functions_list/netlify/functions/user_1.js",␊
        "name": "user_1",␊
        "runtime": "js"␊
      }␊
    ]␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Functions bundling                                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Packaging Functions from .netlify/functions-internal directory:␊
     - internal_1.js␊
    ␊
    Packaging Functions from netlify/functions directory:␊
     - user_1.js␊
    ␊
    ␊
    (Functions bundling completed in 1ms)␊
    Build step duration: Functions bundling completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Git utils fails if no root

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.mjs␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.mjs from netlify.toml␊
    ␊
    ./plugin.mjs (onPreBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    Plugin "./plugin.mjs" internal error                          ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Invalid head commit HEAD␊
      Command failed with exit code 128: git rev-parse HEAD␊
      fatal: not a git repository (or any of the parent directories): .git␊
    ␊
      Error location␊
      In "onPreBuild" event in "./plugin.mjs" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.mjs`

## Git utils does not fail if no root and not used

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: /tmp-dir␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      /tmp-dir␊
    ␊
    > Config file␊
      /tmp-dir/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: /tmp-dir␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.mjs␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.mjs from netlify.toml␊
    ␊
    ./plugin.mjs (onPreBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    build cache functions git run status␊
    ␊
    (./plugin.mjs onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.mjs onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Validate plugin is an object

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/object␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/object␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/object/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/object␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Plugin must be an object or a function␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      While loading "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/object␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Validate plugin event handler names

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/handler_name␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/handler_name␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/handler_name/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/handler_name␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: Invalid event 'onInvalid'.␊
      Please use a valid event name. One of:␊
       - onPreBuild␊
       - onBuild␊
       - onPostBuild␊
       - onSuccess␊
       - onError␊
       - onEnd␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      While loading "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/handler_name␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Validate plugin event handler function

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/handler_function␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/handler_function␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/handler_function/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/handler_function␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    Plugin "./plugin" internal error                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      TypeError: Invalid event handler 'onBuild': must be a function␊
    ␊
      Plugin details␊
      Package:        ./plugin␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      While loading "./plugin" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/handler_function␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin`

## Transpile TypeScript local plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/ts_transpile␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/ts_transpile␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/ts_transpile/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/ts_transpile␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.ts␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.ts from netlify.toml␊
    ␊
    ./plugin.ts (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (./plugin.ts onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.ts onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Type-checks TypeScript local plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/ts_type_check␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/ts_type_check␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/ts_type_check/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/ts_type_check␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.ts␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.ts from netlify.toml␊
    ␊
    Plugin "./plugin.ts" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Could not import plugin:␊
      TSError: ⨯ Unable to compile TypeScript:␊
      plugin.ts(8,3): error TS2554: Expected 1-2 arguments, but got 0.␊
    ␊
      TypeScript configuration␊
      compilerOptions:␊
        declaration: false␊
        esModuleInterop: true␊
        forceConsistentCasingInFileNames: true␊
        inlineSourceMap: false␊
        inlineSources: true␊
        lib:␊
          - es2000␊
        module: commonjs␊
        moduleResolution: node␊
        noEmit: false␊
        outDir: .ts-node␊
        skipLibCheck: true␊
        sourceMap: true␊
        strict: true␊
        target: es2000␊
        types:␊
          - node␊
      tsNodeOptions:␊
        optionBasePaths: {}␊
        require: []␊
    ␊
      Plugin details␊
      Package:        ./plugin.ts␊
      Repository:     test␊
    ␊
      Error location␊
      While loading "./plugin.ts" from netlify.toml␊
    STACK TRACE␊
    ␊
      Error properties␊
      {␊
        diagnosticCodes: [ 2554 ],␊
        diagnosticText: 'plugin.ts(8,3): error TS2554: Expected 1-2 arguments, but got 0./n'␊
      }␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/ts_type_check␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.ts`

## Type-checks TypeScript local plugins using tsconfig.json

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/ts_type_check_tsconfig␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/ts_type_check_tsconfig␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/ts_type_check_tsconfig/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/ts_type_check_tsconfig␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.ts␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.ts from netlify.toml␊
    ␊
    ./plugin.ts (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined␊
    ␊
    (./plugin.ts onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.ts onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Does not transpile already transpiled local plugins

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/ts_transpile_already␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/ts_transpile_already␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/ts_transpile_already/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/ts_transpile_already␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.cjs␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.cjs@1.0.0 from netlify.toml␊
    ␊
    ./plugin.cjs (onPreBuild event)                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    JavaScript␊
    ␊
    (./plugin.cjs onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.cjs onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Plugins which export a factory function receive the inputs and a metadata object

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins/fixtures/dynamic_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins/fixtures/dynamic_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins/fixtures/dynamic_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins/fixtures/dynamic_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onPreBuild:␊
    -> events: [␊
      'onPreDev',␊
      'onDev',␊
      'onPreBuild',␊
      'onBuild',␊
      'onPostBuild',␊
      'onSuccess',␊
      'onError',␊
      'onEnd'␊
    ]␊
    -> version: 1.0.0␊
    -> constants: {␊
      CONFIG_PATH: 'netlify.toml',␊
      FUNCTIONS_DIST: '.netlify/functions/',␊
      EDGE_FUNCTIONS_DIST: '.netlify/edge-functions-dist/',␊
      CACHE_DIR: '.netlify/cache',␊
      IS_LOCAL: true,␊
      NETLIFY_BUILD_VERSION: '1.0.0',␊
      NETLIFY_API_HOST: 'api.netlify.com',␊
      INTERNAL_FUNCTIONS_SRC: '.netlify/functions-internal',␊
      INTERNAL_EDGE_FUNCTIONS_SRC: '.netlify/edge-functions',␊
      PUBLISH_DIR: '.'␊
    }␊
    -> inputs: { some_input: 'some string' }␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    Build step duration: ./plugin onPreBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`
