# Snapshot report for `tests/plugins_list/tests.js`

The actual snapshot is saved in `tests.js.snap`.

Generated by [AVA](https://avajs.dev).

## Install plugins in .netlify/plugins/ when not cached

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/valid_package␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/valid_package␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/valid_package/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/valid_package␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Use plugins cached in .netlify/plugins/

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_cache␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_cache␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Do not use plugins cached in .netlify/plugins/ if outdated

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_cache_outdated␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_cache_outdated␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_cache_outdated/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_cache_outdated␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Fetches the list of plugin versions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_cache␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_cache␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Only prints the list of plugin versions in verbose mode

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Uses fallback when the plugins fetch fails

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_cache␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_cache␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    Warning: could not fetch latest plugins list. Plugins versions might not be the latest.␊
    Response code 500 (Internal Server Error)␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Uses fallback when the plugins fetch succeeds with an invalid response

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_cache␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_cache␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_cache/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_cache␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    Warning: could not fetch latest plugins list. Plugins versions might not be the latest.␊
    Request succeeded but with an invalid response:␊
    {␊
      "error": "test"␊
    }␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Can execute local binaries when using .netlify/plugins/

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_cache_bin␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_cache_bin␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_cache_bin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_cache_bin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    1.0.0␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Can require site dependencies when using .netlify/plugins/

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_cache_site_deps␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_cache_site_deps␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_cache_site_deps/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_cache_site_deps␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    true␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Works with .netlify being a regular file

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_cache_regular_file␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_cache_regular_file␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_cache_regular_file/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_cache_regular_file␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Print a warning when using plugins not in plugins.json nor package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/invalid_package␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/invalid_package␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/invalid_package/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/invalid_package␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: power-cartesian-product␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    `

## Can use local plugins even when some plugins are cached

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_cache_local␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_cache_local␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_cache_local/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_cache_local␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onPostBuild event)                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (./plugin.js onPostBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Prints outdated plugins installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_outdated_package_json␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_outdated_package_json␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_outdated_package_json/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_outdated_package_json␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml and package.json (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please update its version in "package.json"␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Prints incompatible plugins installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_incompatible_package_json␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_incompatible_package_json␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_incompatible_package_json/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_incompatible_package_json␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 1-0-0 from netlify.toml and package.json (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Incompatible plugins␊
       - netlify-plugin-contextual-env 1-0-0: version 1.0.0 is the most recent version compatible with Node.js <100␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not print incompatible plugins installed in package.json if major version is same

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_incompatible_package_json_same_major␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_incompatible_package_json_same_major␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_incompatible_package_json_same_major/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_incompatible_package_json_same_major␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-4-0 from netlify.toml and package.json (latest 0-4-0, expected 0-4-1, compatible 0-4-1)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not print incompatible plugins installed in package.json if not using the compatibility field

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_incompatible_package_json␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_incompatible_package_json␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_incompatible_package_json/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_incompatible_package_json␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 1-0-0 from netlify.toml and package.json (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify non-matching compatibility.nodeVersion

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-1-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-1-0 from netlify.toml (latest 0-3-0, expected 0-1-0, compatible 0-1-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-1-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins ignore compatibility entries without conditions unless pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-1-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-1-0 from netlify.toml (latest 0-3-0, expected 0-1-0, compatible 0-1-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-1-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins does not ignore compatibility entries without conditions if pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (pinned 0-2-0, latest 0-3-0, expected 0-2-0, compatible 0-3-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins ignore compatibility conditions if pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (pinned 0-2-0, latest 0-3-0, expected 0-2-0, compatible 0-3-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify matching compatibility.nodeVersion

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins compatibility defaults to version field

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify compatibility.migrationGuide

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-1-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-1-0 from netlify.toml (latest 0-3-0, expected 0-1-0, compatible 0-1-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-1-0: latest version is 0-3-0␊
         Migration guide: http://test.com␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify matching compatibility.siteDependencies

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify non-matching compatibility.siteDependencies

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify non-existing compatibility.siteDependencies

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify multiple non-matching compatibility conditions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify multiple matching compatibility conditions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugins can specify non-matching compatibility.siteDependencies range

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies_range␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies_range␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies_range/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_site_dependencies_range␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-3-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-2-0: latest version is 0-3-0␊
         To upgrade this plugin, please remove it from "netlify.toml" and install it from the Netlify plugins directory instead (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugin versions can be feature flagged

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugin versions that are feature flagged are ignored if no matching feature flag

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-2-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-2-0 from netlify.toml (latest 0-2-0, expected 0-2-0, compatible 0-2-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Plugin pinned versions that are feature flagged are not ignored if pinned but no matching feature flag

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (pinned 0-3-0, latest 0-2-0, expected 0-3-0, compatible 0-2-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Compatibility order take precedence over the `featureFlag` property

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_compat_node_version/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_compat_node_version␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Installing plugins␊
       - netlify-plugin-contextual-env 0-3-0␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Nothing found... keeping default ENVs␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Pin plugin versions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Report updatePlugin API error without failing the build

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      API error on "updatePlugin"                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Bad Request␊
    ␊
      Error location␊
      While calling the Netlify API endpoint 'updatePlugin' with:␊
      {␊
        "package": "netlify-plugin-contextual-env",␊
        "site_id": "test",␊
        "body": {␊
          "pinned_version": "0.3"␊
        }␊
      }␊
    ␊
      Error properties␊
      { name: 'JSONHTTPError', status: 400, json: {} }␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not report 404 updatePlugin API error

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Only pin plugin versions in production

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_success␊
      sendStatus: false␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Do not pin plugin versions without an API token

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Do not pin plugin versions without a siteId

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_success␊
      sendStatus: true␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Do not pin plugin versions if the build failed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_build_failed␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_build_failed␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/pin_build_failed/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node --invalid␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins_list/fixtures/pin_build_failed␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. build.command from netlify.toml                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node --invalid␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      "build.command" failed                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Command failed with exit code 9: node --invalid␊
    ␊
      Error location␊
      In build.command from netlify.toml:␊
      node --invalid␊
    ␊
      Resolved config␊
      build:␊
        command: node --invalid␊
        commandOrigin: config␊
        publish: packages/build/tests/plugins_list/fixtures/pin_build_failed␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    node: bad option: --invalid`

## Do not pin plugin versions if the plugin failed

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_plugin_failed␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_plugin_failed␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_plugin_failed␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "netlify-plugin-contextual-env" failed                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: test␊
    ␊
      Plugin details␊
      Package:        netlify-plugin-contextual-env␊
      Version:        1.0.0␊
      Repository:     test␊
      npm link:       https://www.npmjs.com/package/netlify-plugin-contextual-env␊
    ␊
      Error location␊
      In "onPreBuild" event in "netlify-plugin-contextual-env" from Netlify app␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_plugin_failed␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Do not pin plugin versions if the build was installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_module␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_module␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/pin_module/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_module␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-test␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-test@1.0.0 from netlify.toml and package.json␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-test (onPreBuild event)                     ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-test onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Do not pin plugin versions if already pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (pinned 0, latest 1-0-0, expected 0, compatible 1-0-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-3-0: latest version is 1-0-0␊
         To upgrade this plugin, please uninstall and re-install it from the Netlify plugins directory (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Pinning plugin versions takes into account the compatibility field

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_success␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (pinned 0, latest 1-0-0, expected 0-3-0, compatible 100-0-0)␊
    ␊
    > Outdated plugins␊
       - netlify-plugin-contextual-env 0-3-0: latest version is 1-0-0␊
         To upgrade this plugin, please uninstall and re-install it from the Netlify plugins directory (https://app.netlify.com/plugins)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Pin netlify.toml-only plugin versions

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (pinned 0.3, latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not pin netlify.toml-only plugin versions if there are no matching plugin runs

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not pin netlify.toml-only plugin versions if there are no plugin runs

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not pin netlify.toml-only plugin versions if there are no matching plugin runs version

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Fails the build when pinning netlify.toml-only plugin versions and the API request fails

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      API error on "getLatestPluginRuns"                            ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Bad Request␊
    ␊
      Error location␊
      While calling the Netlify API endpoint 'getLatestPluginRuns' with:␊
      {␊
        "site_id": "test",␊
        "packages": [␊
          "netlify-plugin-contextual-env"␊
        ],␊
        "state": "success"␊
      }␊
    ␊
      Error properties␊
      {␊
        name: 'JSONHTTPError',␊
        status: 400,␊
        json: [ { package: 'netlify-plugin-contextual-env', version: '1.0.0' } ]␊
      }␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env`

## Does not pin netlify.toml-only plugin versions if already pinned

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (pinned 0, latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not pin netlify.toml-only plugin versions if installed in UI

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_config_ui␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_config_ui␊
    ␊
    > Config file␊
      No config file was defined: using default values.␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_config_ui␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: ui␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from Netlify app (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not pin netlify.toml-only plugin versions if installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_config_module␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_config_module␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/pin_config_module/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_config_module␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 1-0-1 from netlify.toml and package.json (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not pin netlify.toml-only plugin versions if there are no API token

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_config_success␊
      sendStatus: true␊
      siteId: test␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Does not pin netlify.toml-only plugin versions if there are no site ID

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/pin_config_success␊
      sendStatus: true␊
      testOpts:␊
        host: /test/socket␊
        pluginsListUrl: /test/socket␊
        scheme: http␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/pin_config_success␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/pin_config_success/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/pin_config_success␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: netlify-plugin-contextual-env␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Loading plugins␊
       - netlify-plugin-contextual-env 0-3-0 from netlify.toml (latest 0-3-0, expected 0-3-0, compatible 0-3-0)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. netlify-plugin-contextual-env (onPreBuild event)           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    (netlify-plugin-contextual-env onPreBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Errors if unsupported Next.js Runtime plugin version is installed in package.json

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      featureFlags:␊
        - plugins_break_builds_with_unsupported_plugin_versions␊
      repositoryRoot: packages/build/tests/plugins_list/fixtures/plugins_unsupported_version_package_json␊
      testOpts:␊
        pluginsListUrl: /test/socket␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_list/fixtures/plugins_unsupported_version_package_json␊
    ␊
    > Config file␊
      packages/build/tests/plugins_list/fixtures/plugins_unsupported_version_package_json/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_unsupported_version_package_json␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: '@netlify/plugin-nextjs'␊
    ␊
    > Context␊
      production␊
    ␊
    > Available plugins␊
    ␊
    > Using Next.js Runtime - v1.0.0␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Unsupported plugin version detected                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      This site cannot be built because it is using an outdated version of the Next.js Runtime: @netlify/plugin-nextjs@1.0.0 Versions greater than 1.0.0 are recommended. To upgrade this plugin, please update its version in "package.json" to the latest version: 1.0.0. If you cannot use a more recent version, please contact support at https://www.netlify.com/support for guidance.␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_list/fixtures/plugins_unsupported_version_package_json␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: '@netlify/plugin-nextjs'`
