# Snapshot report for `tests/secrets_scanning/tests.js`

The actual snapshot is saved in `tests.js.snap`.

Generated by [AVA](https://avajs.dev).

## secrets scanning, don't run when secrets are provided/default

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/secrets_scanning/fixtures/src_default␊
    ␊
    > Config file␊
      packages/build/tests/secrets_scanning/fixtures/src_default/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## secrets scanning, don't run when there are no secrets

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/secrets_scanning/fixtures/src_default␊
    ␊
    > Config file␊
      packages/build/tests/secrets_scanning/fixtures/src_default/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## secrets scanning, should skip with secrets but SECRETS_SCAN_ENABLED=false

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/secrets_scanning/fixtures/src_scanning_disabled␊
    ␊
    > Config file␊
      packages/build/tests/secrets_scanning/fixtures/src_scanning_disabled/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    Scanning for secrets in code and build output.                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Secrets scanning disabled via SECRETS_SCAN_ENABLED flag set to false.␊
    ␊
    (Secrets scanning completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## secrets scanning, should skip when secrets passed but no env vars set

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/secrets_scanning/fixtures/src_default␊
    ␊
    > Config file␊
      packages/build/tests/secrets_scanning/fixtures/src_default/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin@1.0.0 from netlify.toml␊
    ␊
    ./plugin (onPreBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    undefined␊
    ␊
    (./plugin onPreBuild completed in 1ms)␊
    ␊
    Scanning for secrets in code and build output.                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Secrets scanning skipped because no env vars marked as secret are set to non-empty/non-trivial values or they are all omitted with SECRETS_SCAN_OMIT_KEYS env var setting.␊
    ␊
    (Secrets scanning completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## secrets scanning, should skip when secrets passed but no non-empty/trivial env vars set

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/secrets_scanning/fixtures/src_scanning_env_vars_set_empty␊
    ␊
    > Config file␊
      packages/build/tests/secrets_scanning/fixtures/src_scanning_env_vars_set_empty/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    Scanning for secrets in code and build output.                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    Secrets scanning skipped because no env vars marked as secret are set to non-empty/non-trivial values or they are all omitted with SECRETS_SCAN_OMIT_KEYS env var setting.␊
    ␊
    (Secrets scanning completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## secrets scanning, should skip when secrets passed but SECRETS_SCAN_OMIT_KEYS omits all of them

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/secrets_scanning/fixtures/src_scanning_omit_all_keys␊
    ␊
    > Config file␊
      packages/build/tests/secrets_scanning/fixtures/src_scanning_omit_all_keys/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    Scanning for secrets in code and build output.                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    SECRETS_SCAN_OMIT_KEYS override option set to: ENV_VAR_2,ENV_VAR_1␊
    ␊
    Secrets scanning skipped because no env vars marked as secret are set to non-empty/non-trivial values or they are all omitted with SECRETS_SCAN_OMIT_KEYS env var setting.␊
    ␊
    (Secrets scanning completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## secrets scanning, should skip when secrets passed but SECRETS_SCAN_OMIT_PATHS omits all files

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/secrets_scanning/fixtures/src_scanning_omit_all_paths␊
    ␊
    > Config file␊
      packages/build/tests/secrets_scanning/fixtures/src_scanning_omit_all_paths/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    build.command from netlify.toml                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ cp -r ./src/static-files ./dist␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    Scanning for secrets in code and build output.                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    SECRETS_SCAN_OMIT_PATHS override option set to: /external/path␊
    ␊
    Secrets scanning skipped because there are no files or all files were omitted with SECRETS_SCAN_OMIT_PATHS env var setting.␊
    ␊
    (Secrets scanning completed in 1ms)␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## secrets scanning, should skip when secrets passed but SECRETS_SCAN_OMIT_PATHS omits globbed files

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/secrets_scanning/fixtures/src_scanning_omit_glob_path␊
    ␊
    > Config file␊
      packages/build/tests/secrets_scanning/fixtures/src_scanning_omit_glob_path/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    build.command from netlify.toml                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ cp -r ./src/static-files ./dist␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    Scanning for secrets in code and build output.                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    SECRETS_SCAN_OMIT_PATHS override option set to: netlify.toml,**/safefile.js␊
    ␊
    ␊
    > Scanning complete. 6 file(s) scanned. Secrets scanning found 2 instance(s) of secrets in build output or repo code.␊
    ␊
    Secret env var "ENV_VAR_2"'s value detected:␊
      found value at line 1 in dist/static-files/notsafefile.js␊
      found value at line 1 in src/static-files/notsafefile.js␊
    ␊
    To prevent exposing secrets, the build will fail until these secret values are not found in build output or repo files.␊
    If these are expected, use SECRETS_SCAN_OMIT_PATHS, SECRETS_SCAN_OMIT_KEYS, or SECRETS_SCAN_ENABLED to prevent detecting.␊
    For more information on secrets scanning, see the Netlify Docs: https://ntl.fyi/configure-secrets-scanning␊
    ␊
    Secrets scanning detected secrets in files during build.      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Secrets scanning found secrets in build.␊
    ␊
      Resolved config␊
      build:␊
        command: cp -r ./src/static-files ./dist␊
        commandOrigin: config␊
        environment:␊
          - ENV_VAR_1␊
          - ENV_VAR_2␊
          - SECRETS_SCAN_OMIT_PATHS␊
        publish: packages/build/tests/secrets_scanning/fixtures/src_scanning_omit_glob_path/dist␊
        publishOrigin: config`

## secrets scanning, should fail build when it finds secrets in the src and build output

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: false␊
    ␊
    > Current directory␊
      packages/build/tests/secrets_scanning/fixtures/src_scanning_env_vars_set_non_empty␊
    ␊
    > Config file␊
      packages/build/tests/secrets_scanning/fixtures/src_scanning_env_vars_set_non_empty/netlify.toml␊
    ␊
    > Context␊
      production␊
    ␊
    build.command from netlify.toml                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ cp -r ./src/. ./dist␊
    ␊
    (build.command completed in 1ms)␊
    ␊
    Scanning for secrets in code and build output.                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    > Scanning complete. 14 file(s) scanned. Secrets scanning found 32 instance(s) of secrets in build output or repo code.␊
    ␊
    Secret env var "ENV_VAR_1"'s value detected:␊
      found value at line 12 in dist/static-files/static-a.txt␊
      found value at line 6 in netlify.toml␊
      found value at line 12 in src/static-files/static-a.txt␊
    Secret env var "ENV_VAR_2"'s value detected:␊
      found value at line 1 in dist/some-file.txt␊
      found value at line 1 in dist/static-files/static-a.txt␊
      found value at line 6 in dist/static-files/static-a.txt␊
      found value at line 7 in netlify.toml␊
      found value at line 1 in src/some-file.txt␊
      found value at line 1 in src/static-files/static-a.txt␊
      found value at line 6 in src/static-files/static-a.txt␊
    Secret env var "ENV_VAR_3"'s value detected:␊
      found value at line 14 in dist/static-files/static-a.txt␊
      found value at line 16 in dist/static-files/static-a.txt␊
      found value at line 1 in dist/static-files/static-c.txt␊
      found value at line 8 in netlify.toml␊
      found value at line 14 in src/static-files/static-a.txt␊
      found value at line 16 in src/static-files/static-a.txt␊
      found value at line 1 in src/static-files/static-c.txt␊
    Secret env var "ENV_VAR_4"'s value detected:␊
      found value at line 20 in dist/static-files/static-a.txt␊
      found value at line 9 in netlify.toml␊
      found value at line 20 in src/static-files/static-a.txt␊
    Secret env var "ENV_VAR_MULTILINE_A"'s value detected:␊
      found value at line 17 in dist/static-files/static-c.txt␊
      found value at line 38 in dist/static-files/static-c.txt␊
      found value at line 1 in dist/static-files/static-d.txt␊
      found value at line 15 in netlify.toml␊
      found value at line 17 in src/static-files/static-c.txt␊
      found value at line 38 in src/static-files/static-c.txt␊
      found value at line 1 in src/static-files/static-d.txt␊
    Secret env var "ENV_VAR_MULTILINE_B"'s value detected:␊
      found value at line 4 in dist/static-files/static-d.txt␊
      found value at line 1 in dist/static-files/static-e.txt␊
      found value at line 21 in netlify.toml␊
      found value at line 4 in src/static-files/static-d.txt␊
      found value at line 1 in src/static-files/static-e.txt␊
    ␊
    To prevent exposing secrets, the build will fail until these secret values are not found in build output or repo files.␊
    If these are expected, use SECRETS_SCAN_OMIT_PATHS, SECRETS_SCAN_OMIT_KEYS, or SECRETS_SCAN_ENABLED to prevent detecting.␊
    For more information on secrets scanning, see the Netlify Docs: https://ntl.fyi/configure-secrets-scanning␊
    ␊
    Secrets scanning detected secrets in files during build.      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Secrets scanning found secrets in build.␊
    ␊
      Resolved config␊
      build:␊
        command: cp -r ./src/. ./dist␊
        commandOrigin: config␊
        environment:␊
          - ENV_VAR_1␊
          - ENV_VAR_2␊
          - ENV_VAR_3␊
          - ENV_VAR_4␊
          - ENV_VAR_5␊
          - ENV_VAR_6␊
          - ENV_VAR_7␊
          - NOT_SECRET_VAL␊
          - ENV_VAR_MULTILINE_A␊
          - ENV_VAR_MULTILINE_B␊
          - ENV_VAR_MULTI_NOT_SECRET␊
        publish: packages/build/tests/secrets_scanning/fixtures/src_scanning_env_vars_set_non_empty/dist␊
        publishOrigin: config`
