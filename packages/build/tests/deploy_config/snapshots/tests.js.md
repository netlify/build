# Snapshot report for `tests/deploy_config/tests.js`

The actual snapshot is saved in `tests.js.snap`.

Generated by [AVA](https://avajs.dev).

## Does not mutate read-only properties

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/deploy_config/fixtures/readonly_properties␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/deploy_config/fixtures/readonly_properties␊
    ␊
    > Config file␊
      packages/build/tests/deploy_config/fixtures/readonly_properties/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: echo Hello␊
        commandOrigin: config␊
        publish: packages/build/tests/deploy_config/fixtures/readonly_properties/publish/user␊
        publishOrigin: config␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
      redirects:␊
        - from:/$netlify-snapshot-preserve/from␊
          status: 200␊
          to:/$netlify-snapshot-preserve/to␊
      redirectsOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ./plugin.js (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onPreBuild: {␊
      redirectsOrigin: 'config',␊
      functions: { '*': {} },␊
      plugins: [ { package: './plugin.js', origin: 'config', inputs: {} } ],␊
      build: {␊
        environment: {},␊
        publish: 'packages/build/tests/deploy_config/fixtures/readonly_properties/publish/user',␊
        publishOrigin: 'config',␊
        processing: { css: {}, html: {}, images: {}, js: {} },␊
        services: {},␊
        command: 'echo Hello',␊
        commandOrigin: 'config'␊
      },␊
      headers: [],␊
      redirects: [␊
        {␊
          from: /$netlify-snapshot-preserve/from',␊
          query: {},␊
          to: /$netlify-snapshot-preserve/to',␊
          status: 200,␊
          force: false,␊
          conditions: {},␊
          headers: {}␊
        }␊
      ]␊
    }␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.js onPreBuild completed in 1ms␊
    ␊
    build.command from netlify.toml                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ echo Hello␊
    Hello␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    Discarding property that is not supported by the Deploy Configuration API: build.command␊
    Loading property from Deploy Configuration API: build.publish␊
    Discarding property that is not supported by the Deploy Configuration API: build.processing␊
    Discarding property that is not supported by the Deploy Configuration API: plugins␊
    Loading property from Deploy Configuration API: redirects␊
    Discarding property that is not supported by the Deploy Configuration API: unknown_property␊
    ␊
    ./plugin.js (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild: {␊
      redirectsOrigin: 'config',␊
      functions: { '*': {} },␊
      plugins: [ { package: './plugin.js', origin: 'config', inputs: {} } ],␊
      build: {␊
        publish: 'packages/build/tests/deploy_config/fixtures/readonly_properties/publish/user',␊
        environment: {},␊
        publishOrigin: 'config',␊
        processing: { css: {}, html: {}, images: {}, js: {} },␊
        services: {},␊
        command: 'echo Hello',␊
        commandOrigin: 'config'␊
      },␊
      headers: [],␊
      redirects: [␊
        {␊
          from: /$netlify-snapshot-preserve/from-config-override',␊
          to: /$netlify-snapshot-preserve/to-config-override',␊
          status: 418,␊
          force: true␊
        },␊
        {␊
          from: /$netlify-snapshot-preserve/from',␊
          query: {},␊
          to: /$netlify-snapshot-preserve/to',␊
          status: 200,␊
          force: false,␊
          conditions: {},␊
          headers: {}␊
        },␊
        {␊
          from: /$netlify-snapshot-preserve/from-config',␊
          to: /$netlify-snapshot-preserve/to-config',␊
          status: 418,␊
          force: true␊
        }␊
      ]␊
    }␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    Build step duration: ./plugin.js onBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Loads configuration data that has been generated by the build command

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/deploy_config/fixtures/from_build_command␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/deploy_config/fixtures/from_build_command␊
    ␊
    > Config file␊
      packages/build/tests/deploy_config/fixtures/from_build_command/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: node write_config.mjs␊
        commandOrigin: config␊
        publish: packages/build/tests/deploy_config/fixtures/from_build_command␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
      redirects:␊
        - from:/$netlify-snapshot-preserve/from␊
          status: 200␊
          to:/$netlify-snapshot-preserve/to␊
      redirectsOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ./plugin.js (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onPreBuild: {␊
      redirectsOrigin: 'config',␊
      functions: { '*': {} },␊
      plugins: [ { package: './plugin.js', origin: 'config', inputs: {} } ],␊
      build: {␊
        environment: {},␊
        publish: 'packages/build/tests/deploy_config/fixtures/from_build_command',␊
        publishOrigin: 'default',␊
        processing: { css: {}, html: {}, images: {}, js: {} },␊
        services: {},␊
        command: 'node write_config.mjs',␊
        commandOrigin: 'config'␊
      },␊
      headers: [],␊
      redirects: [␊
        {␊
          from: /$netlify-snapshot-preserve/from',␊
          query: {},␊
          to: /$netlify-snapshot-preserve/to',␊
          status: 200,␊
          force: false,␊
          conditions: {},␊
          headers: {}␊
        }␊
      ]␊
    }␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.js onPreBuild completed in 1ms␊
    ␊
    build.command from netlify.toml                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ node write_config.mjs␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    Loading property from Deploy Configuration API: functions.my_framework*.included_files␊
    Loading property from Deploy Configuration API: redirects␊
    Loading property from Deploy Configuration API: images.remote_images␊
    ␊
    ./plugin.js (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild: {␊
      redirectsOrigin: 'config',␊
      functions: { 'my_framework*': { included_files: [Array] }, '*': {} },␊
      plugins: [ { package: './plugin.js', origin: 'config', inputs: {} } ],␊
      build: {␊
        environment: {},␊
        publish: 'packages/build/tests/deploy_config/fixtures/from_build_command',␊
        publishOrigin: 'default',␊
        processing: { css: {}, html: {}, images: {}, js: {} },␊
        services: {},␊
        command: 'node write_config.mjs',␊
        commandOrigin: 'config'␊
      },␊
      headers: [],␊
      redirects: [␊
        {␊
          from: /$netlify-snapshot-preserve/from-config-override',␊
          to: /$netlify-snapshot-preserve/to-config-override',␊
          status: 418,␊
          force: true␊
        },␊
        {␊
          from: /$netlify-snapshot-preserve/from',␊
          query: {},␊
          to: /$netlify-snapshot-preserve/to',␊
          status: 200,␊
          force: false,␊
          conditions: {},␊
          headers: {}␊
        },␊
        {␊
          from: /$netlify-snapshot-preserve/from-config',␊
          to: /$netlify-snapshot-preserve/to-config',␊
          status: 418,␊
          force: true␊
        }␊
      ],␊
      images: { remote_images: [ 'domain1.netlify', 'domain2.netlify' ] }␊
    }␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    Build step duration: ./plugin.js onBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Merges configuration after the `onPreBuild` and before the `onBuild` plugin events

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/deploy_config/fixtures/deploy_config␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/deploy_config/fixtures/deploy_config␊
    ␊
    > Config file␊
      packages/build/tests/deploy_config/fixtures/deploy_config/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: echo Hello␊
        commandOrigin: config␊
        publish: packages/build/tests/deploy_config/fixtures/deploy_config␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
      redirects:␊
        - from:/$netlify-snapshot-preserve/from␊
          status: 200␊
          to:/$netlify-snapshot-preserve/to␊
      redirectsOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ./plugin.js (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onPreBuild: {␊
      redirectsOrigin: 'config',␊
      functions: { '*': {} },␊
      plugins: [ { package: './plugin.js', origin: 'config', inputs: {} } ],␊
      build: {␊
        environment: {},␊
        publish: 'packages/build/tests/deploy_config/fixtures/deploy_config',␊
        publishOrigin: 'default',␊
        processing: { css: {}, html: {}, images: {}, js: {} },␊
        services: {},␊
        command: 'echo Hello',␊
        commandOrigin: 'config'␊
      },␊
      headers: [],␊
      redirects: [␊
        {␊
          from: /$netlify-snapshot-preserve/from',␊
          query: {},␊
          to: /$netlify-snapshot-preserve/to',␊
          status: 200,␊
          force: false,␊
          conditions: {},␊
          headers: {}␊
        }␊
      ]␊
    }␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.js onPreBuild completed in 1ms␊
    ␊
    build.command from netlify.toml                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ echo Hello␊
    Hello␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    Loading property from Deploy Configuration API: functions.my_framework*.included_files␊
    Loading property from Deploy Configuration API: redirects␊
    Loading property from Deploy Configuration API: images.remote_images␊
    ␊
    ./plugin.js (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild: {␊
      redirectsOrigin: 'config',␊
      functions: { 'my_framework*': { included_files: [Array] }, '*': {} },␊
      plugins: [ { package: './plugin.js', origin: 'config', inputs: {} } ],␊
      build: {␊
        environment: {},␊
        publish: 'packages/build/tests/deploy_config/fixtures/deploy_config',␊
        publishOrigin: 'default',␊
        processing: { css: {}, html: {}, images: {}, js: {} },␊
        services: {},␊
        command: 'echo Hello',␊
        commandOrigin: 'config'␊
      },␊
      headers: [],␊
      redirects: [␊
        {␊
          from: /$netlify-snapshot-preserve/from-config-override',␊
          to: /$netlify-snapshot-preserve/to-config-override',␊
          status: 418,␊
          force: true␊
        },␊
        {␊
          from: /$netlify-snapshot-preserve/from',␊
          query: {},␊
          to: /$netlify-snapshot-preserve/to',␊
          status: 200,␊
          force: false,␊
          conditions: {},␊
          headers: {}␊
        },␊
        {␊
          from: /$netlify-snapshot-preserve/from-config',␊
          to: /$netlify-snapshot-preserve/to-config',␊
          status: 418,␊
          force: true␊
        }␊
      ],␊
      images: { remote_images: [ 'domain1.netlify', 'domain2.netlify' ] }␊
    }␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    Build step duration: ./plugin.js onBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`

## Does not throw an error if the deploy configuration file is missing

> Snapshot 1

    `␊
    Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/deploy_config/fixtures/missing_config␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/deploy_config/fixtures/missing_config␊
    ␊
    > Config file␊
      packages/build/tests/deploy_config/fixtures/missing_config/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        command: echo Hello␊
        commandOrigin: config␊
        publish: packages/build/tests/deploy_config/fixtures/missing_config␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
      redirects:␊
        - from:/$netlify-snapshot-preserve/from␊
          status: 200␊
          to:/$netlify-snapshot-preserve/to␊
      redirectsOrigin: config␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ./plugin.js (onPreBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onPreBuild: {␊
      redirectsOrigin: 'config',␊
      functions: { '*': {} },␊
      plugins: [ { package: './plugin.js', origin: 'config', inputs: {} } ],␊
      build: {␊
        environment: {},␊
        publish: 'packages/build/tests/deploy_config/fixtures/missing_config',␊
        publishOrigin: 'default',␊
        processing: { css: {}, html: {}, images: {}, js: {} },␊
        services: {},␊
        command: 'echo Hello',␊
        commandOrigin: 'config'␊
      },␊
      headers: [],␊
      redirects: [␊
        {␊
          from: /$netlify-snapshot-preserve/from',␊
          query: {},␊
          to: /$netlify-snapshot-preserve/to',␊
          status: 200,␊
          force: false,␊
          conditions: {},␊
          headers: {}␊
        }␊
      ]␊
    }␊
    ␊
    (./plugin.js onPreBuild completed in 1ms)␊
    Build step duration: ./plugin.js onPreBuild completed in 1ms␊
    ␊
    build.command from netlify.toml                               ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    $ echo Hello␊
    Hello␊
    ␊
    (build.command completed in 1ms)␊
    Build step duration: build.command completed in 1ms␊
    ␊
    ./plugin.js (onBuild event)                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild: {␊
      redirectsOrigin: 'config',␊
      functions: { '*': {} },␊
      plugins: [ { package: './plugin.js', origin: 'config', inputs: {} } ],␊
      build: {␊
        environment: {},␊
        publish: 'packages/build/tests/deploy_config/fixtures/missing_config',␊
        publishOrigin: 'default',␊
        processing: { css: {}, html: {}, images: {}, js: {} },␊
        services: {},␊
        command: 'echo Hello',␊
        commandOrigin: 'config'␊
      },␊
      headers: [],␊
      redirects: [␊
        {␊
          from: /$netlify-snapshot-preserve/from',␊
          query: {},␊
          to: /$netlify-snapshot-preserve/to',␊
          status: 200,␊
          force: false,␊
          conditions: {},␊
          headers: {}␊
        }␊
      ]␊
    }␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    Build step duration: ./plugin.js onBuild completed in 1ms␊
    ␊
    Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)␊
    Build step duration: Netlify Build completed in 1ms`
