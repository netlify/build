# Snapshot report for `packages/build/tests/plugins_events/tests.mjs`

The actual snapshot is saved in `tests.mjs.snap`.

Generated by [AVA](https://avajs.dev).

## plugin.onSuccess is triggered on success

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/success_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/success_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/success_ok/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/success_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onSuccess event)                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onSuccess␊
    ␊
    (./plugin.js onSuccess completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onSuccess is not triggered on failure

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/success_not_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/success_not_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/success_not_ok/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/success_not_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/success_not_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onSuccess is not triggered on failPlugin()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/success_fail_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/success_fail_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/success_fail_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/success_fail_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" failed                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/success_fail_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onSuccess is not triggered on cancelBuild()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/success_cancel_build␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/success_cancel_build␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/success_cancel_build/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/success_cancel_build␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Build canceled by ./plugin.js                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      onBuild␊
    `

## plugin.onSuccess can fail but does not stop builds

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/success_fail␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/success_fail␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/success_fail/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/success_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onSuccess event)                              ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onSuccess␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onSuccess" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/success_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onError is not triggered on success

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/error_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/error_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/error_ok/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onError is triggered on failure

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/error_not_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/error_not_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/error_not_ok/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_not_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onError event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onError␊
    ␊
    (./plugin.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_not_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onError is not triggered on failPlugin()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/error_fail_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/error_fail_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/error_fail_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_fail_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" failed                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_fail_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onError is triggered on cancelBuild()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/error_cancel_build␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/error_cancel_build␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/error_cancel_build/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_cancel_build␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onError event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onError␊
    ␊
    (./plugin.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Build canceled by ./plugin.js                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      onBuild␊
    `

## plugin.onError can fail

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/error_fail␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/error_fail␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/error_fail/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onError event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onError␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onError" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onError gets an error argument

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/error_argument␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/error_argument␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/error_argument/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_argument␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    test␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onError event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    TestError␊
    test␊
    TestError: test␊
    STACK TRACE␊
    ␊
    (./plugin.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      TestError: test␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_argument␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onError can be used in several plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/error_several␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/error_several␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/error_several/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_several␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
       - ./handler_one.js@1.0.0 from netlify.toml␊
       - ./handler_two.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./handler_one.js (onError event)                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./handler_one.js" internal error                      ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onError␊
    ␊
      Plugin details␊
      Package:        ./handler_one.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onError" event in "./handler_one.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_several␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./handler_two.js (onError event)                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./handler_two.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/error_several␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js`

## plugin.onEnd is triggered on success

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/end_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/end_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/end_ok/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/end_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onBuild␊
    ␊
    (./plugin.js onBuild completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onEnd event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd␊
    ␊
    (./plugin.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onEnd is triggered on failure

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/end_not_ok␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/end_not_ok␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/end_not_ok/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/end_not_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onEnd event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd␊
    ␊
    (./plugin.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/end_not_ok␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onEnd is not triggered on failPlugin()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/end_fail_plugin␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/end_fail_plugin␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/end_fail_plugin/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/end_fail_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" failed                                   ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/end_fail_plugin␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onEnd is triggered on cancelBuild()

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/end_cancel_build␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/end_cancel_build␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/end_cancel_build/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/end_cancel_build␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onEnd event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd␊
    ␊
    (./plugin.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Build canceled by ./plugin.js                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      onBuild␊
    `

## plugin.onEnd can fail but it does not stop builds

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/end_fail␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/end_fail␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/end_fail/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/end_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onEnd event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onEnd␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onEnd" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/end_fail␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## plugin.onEnd and plugin.onError can be used together

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/end_error␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/end_error␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/end_error/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/end_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./plugin.js (onError event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onError␊
    ␊
    (./plugin.js onError completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./plugin.js (onEnd event)                                  ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd␊
    ␊
    (./plugin.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/end_error␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js`

## plugin.onEnd can be used in several plugins

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      repositoryRoot: packages/build/tests/plugins_events/fixtures/end_several␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
    ␊
    > Current directory␊
      packages/build/tests/plugins_events/fixtures/end_several␊
    ␊
    > Config file␊
      packages/build/tests/plugins_events/fixtures/end_several/netlify.toml␊
    ␊
    > Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/end_several␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js␊
    ␊
    > Context␊
      production␊
    ␊
    > Loading plugins␊
       - ./plugin.js@1.0.0 from netlify.toml␊
       - ./handler_one.js@1.0.0 from netlify.toml␊
       - ./handler_two.js@1.0.0 from netlify.toml␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      1. ./plugin.js (onBuild event)                                ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      2. ./handler_one.js (onEnd event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd one␊
    ␊
    (./handler_one.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      3. ./handler_two.js (onEnd event)                             ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    onEnd two␊
    ␊
    (./handler_two.js onEnd completed in 1ms)␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Plugin "./plugin.js" internal error                           ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
      Error message␊
      Error: onBuild␊
    ␊
      Plugin details␊
      Package:        ./plugin.js␊
      Version:        1.0.0␊
      Repository:     git+https://github.com/netlify/build.git␊
      Report issues:  https://github.com/netlify/build/issues␊
    ␊
      Error location␊
      In "onBuild" event in "./plugin.js" from netlify.toml␊
    STACK TRACE␊
    ␊
      Resolved config␊
      build:␊
        publish: packages/build/tests/plugins_events/fixtures/end_several␊
        publishOrigin: default␊
      plugins:␊
        - inputs: {}␊
          origin: config␊
          package: ./plugin.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_one.js␊
        - inputs: {}␊
          origin: config␊
          package: ./handler_two.js`
