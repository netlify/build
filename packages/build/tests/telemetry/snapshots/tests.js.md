# Snapshot report for `packages/build/tests/telemetry/tests.js`

The actual snapshot is saved in `tests.js.snap`.

Generated by [AVA](https://ava.li).

## Telemetry error generates no logs

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      featureFlags:␊
        buildbot_build_telemetry: true␊
      origin: https://...␊
      repositoryRoot: /file/path␊
      siteId: test␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
        telemetryOrigin: /file/path␊
        telemetryTimeout: 20000␊
    ␊
    > Current directory␊
      /file/path␊
    ␊
    > Config file␊
      /file/path␊
    ␊
    > Resolved config␊
      {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Telemetry reports build cancellation

> Snapshot 1

    [
      {
        body: {
          anonymousId: 'uuid',
          event: 'build:ci_build_process_completed',
          properties: {
            buildVersion: 'string',
            nodeVersion: 'string',
            osName: 'string',
            osPlatform: 'string',
            pluginCount: 1,
            plugins: [
              {
                name: './plugin.js',
                origin: 'config',
              },
            ],
            siteId: 'test',
            status: 'cancelled',
          },
          timestamp: 'number',
        },
        headers: 'accept accept-encoding authorization connection content-length content-type host user-agent',
        method: 'POST',
      },
    ]

## Telemetry reports plugin error

> Snapshot 1

    [
      {
        body: {
          anonymousId: 'uuid',
          event: 'build:ci_build_process_completed',
          properties: {
            buildVersion: 'string',
            nodeVersion: 'string',
            osName: 'string',
            osPlatform: 'string',
            pluginCount: 1,
            plugins: [
              {
                name: './plugin.js',
                origin: 'config',
              },
            ],
            siteId: 'test',
            status: 'plugin-error',
          },
          timestamp: 'number',
        },
        headers: 'accept accept-encoding authorization connection content-length content-type host user-agent',
        method: 'POST',
      },
    ]

## Telemetry reports user error

> Snapshot 1

    [
      {
        body: {
          anonymousId: 'uuid',
          event: 'build:ci_build_process_completed',
          properties: {
            buildVersion: 'string',
            nodeVersion: 'string',
            osName: 'string',
            osPlatform: 'string',
            status: 'user-error',
          },
          timestamp: 'number',
        },
        headers: 'accept accept-encoding authorization connection content-length content-type host user-agent',
        method: 'POST',
      },
    ]

## Telemetry success generates no logs

> Snapshot 1

    `␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build                                                 ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    > Version␊
      @netlify/build 1.0.0␊
    ␊
    > Flags␊
      debug: true␊
      featureFlags:␊
        buildbot_build_telemetry: true␊
      repositoryRoot: /file/path␊
      siteId: test␊
      testOpts:␊
        pluginsListUrl: test␊
        silentLingeringProcesses: true␊
        telemetryOrigin: /file/path␊
        telemetryTimeout: 20000␊
    ␊
    > Current directory␊
      /file/path␊
    ␊
    > Config file␊
      /file/path␊
    ␊
    > Resolved config␊
      {}␊
    ␊
    > Context␊
      production␊
    ␊
    ────────────────────────────────────────────────────────────────␊
      Netlify Build Complete                                        ␊
    ────────────────────────────────────────────────────────────────␊
    ␊
    (Netlify Build completed in 1ms)`

## Telemetry success with user id from site info

> Snapshot 1

    [
      {
        body: {
          event: 'build:ci_build_process_completed',
          properties: {
            buildVersion: 'string',
            duration: 'number',
            nodeVersion: 'string',
            osName: 'string',
            osPlatform: 'string',
            pluginCount: 0,
            plugins: [],
            siteId: 'test',
            status: 'success',
            steps: 0,
          },
          timestamp: 'number',
          userId: 'its-me-test',
        },
        headers: 'accept accept-encoding authorization connection content-length content-type host user-agent',
        method: 'POST',
      },
    ]
