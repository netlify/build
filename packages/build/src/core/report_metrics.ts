import { closeClient, formatTags, InputStatsDOptions, startClient, validateStatsDOptions } from '../report/statsd.js'

/**
 * Record number of functions build and differentiate between autogenerated and user generated.
 * Sends to statsd daemon.
 */
export const reportMetrics = async function (statsdOpts: InputStatsDOptions, metrics): Promise<void> {
  if (!validateStatsDOptions(statsdOpts)) {
    return
  }
  console.log({ metrics })
  if (metrics.length === 0) return
  const client = await startClient(statsdOpts)

  metrics.forEach((metric) => {
    client[metric.type](metric.name, metric.value, formatTags(metric.tags))
  })

  await closeClient(client)
}
